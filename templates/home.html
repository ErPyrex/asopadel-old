{% extends 'base.html' %}
{% block title %}Inicio - ASOPADAL BARINAS{% endblock %}

{% block content %}
<div class="container">

  {% if hero_activo %}
  <!-- Hero Section -->
  <section class="hero-section" style="background-image: url('{{ hero_activo.imagen.url }}');">
    <div class="hero-content">
      <h1>{{ hero_activo.titulo }}</h1>
      <p>{{ hero_activo.subtitulo }}</p>
    </div>
  </section>
  {% endif %}

  <h2 class="text-center mt-5"> Bienvenido a ASOPADAL BARINAS</h2>
  <p class="text-center text-muted mb-5">Tu comunidad de pádel en Barinas</p>

  <!-- Panel de acceso -->
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card text-center mb-5">
        <div class="card-header">
          <h3>Accede a tu panel</h3>
        </div>
        <div class="card-body">
          {% if user.is_authenticated %}
            <p class="card-text">Tu sesión está activa. Accede a tu panel personalizado.</p>
            <a href="{% url 'core:dashboard_by_role' %}" class="btn btn-primary">Ir a mi panel</a>
            <form method="POST" action="{% url 'users:logout' %}" class="d-inline">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger mt-2">Cerrar sesión</button>
            </form>
          {% else %}
            <p class="card-text">Inicia sesión para acceder a tu panel personalizado.</p>
            <a href="{% url 'users:login' %}" class="btn btn-primary">Iniciar sesión</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>


  <div class="row">
    <!-- Torneos -->
    <div class="col-md-6">
      <section class="torneos mb-5">
        <h3>Torneos recientes</h3>
        {% if torneos %}
          <div class="list-group">
            {% for torneo in torneos %}
              <a href="{% url 'core:public_torneos_list' %}" class="list-group-item list-group-item-action">
                <div class="d-flex w-100 justify-content-between">
                  <h5 class="mb-1">{{ torneo.nombre }}</h5>
                  <small>{{ torneo.fecha_inicio }}</small>
                </div>
                <p class="mb-1"><strong>Ubicación:</strong> {{ torneo.ubicacion }}</p>
              </a>
            {% endfor %}
          </div>
        {% else %}
          <p>No hay torneos registrados aún.</p>
        {% endif %}
      </section>
    </div>

    <!-- Ranking -->
    <div class="col-md-6">
      <section class="ranking mb-5">
        <h3>Top 10 del Ranking</h3>
        {% if ranking %}
          <ul class="list-group">
            {% for jugador in ranking %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <strong>{{ jugador.nombre }}</strong>
                <span class="badge bg-primary rounded-pill">{{ jugador.puntos }} pts</span>
              </li>
            {% endfor %}
          </ul>
          <a href="{% url 'core:public_ranking_list' %}" class="btn btn-primary mt-3">Ver Ranking Completo</a>
        {% else %}
          <p>No hay jugadores en el ranking aún.</p>
        {% endif %}
      </section>
    </div>
  </div>


  <!-- Canchas -->
  <section class="estado-canchas mb-5">
    <h3>Actualidad de las canchas</h3>
    <div class="row">
      {% for cancha in canchas %}
        <div class="col-md-4 mb-4">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title">{{ cancha.nombre }}</h5>
              <p class="card-text"><strong>Ubicación:</strong> {{ cancha.ubicacion }}</p>
              <p class="card-text"><strong>Tipo:</strong> {{ cancha.tipo }}</p>
              <p class="card-text"><strong>Estado:</strong>
                {% if cancha.estado == 'disponible' %}
                  <span class="badge bg-success">Disponible</span>
                {% elif cancha.estado == 'reservada' %}
                  <span class="badge bg-danger">Ocupada</span>
                {% elif cancha.estado == 'mantenimiento' %}
                  <span class="badge bg-warning text-dark">En mantenimiento</span>
                {% else %}
                  <span class="badge bg-secondary">Estado desconocido</span>
                {% endif %}
              </p>

              {% if user.is_authenticated %}
                {% if user.es_jugador %}
                  {% if cancha.estado == 'disponible' %}
                    <form method="get" action="{% url 'core:player_reserve_court' %}">
                      <input type="hidden" name="cancha_id" value="{{ cancha.id }}">
                      <button type="submit" class="btn btn-primary">Reservar esta cancha</button>
                    </form>
                  {% else %}
                    <p class="text-muted">Esta cancha no está disponible para reserva.</p>
                  {% endif %}
                {% else %}
                  <p class="text-muted">Solo los jugadores pueden reservar canchas.</p>
                {% endif %}
              {% else %}
                <p class="text-muted">Inicia sesión como jugador para reservar.</p>
              {% endif %}
            </div>
          </div>
        </div>
      {% empty %}
        <p>No hay canchas disponibles o registradas en este momento.</p>
      {% endfor %}
    </div>
    <a href="{% url 'core:public_canchas_list' %}" class="btn btn-primary mt-3">Ver todas las canchas</a>
  </section>

  <!-- Noticias -->
  <section class="seccion-noticias mb-5">
    <h3>Noticias recientes</h3>
    <div class="row">
      {% if noticias %}
        {% for noticia in noticias %}
          <div class="col-md-4 mb-4">
            <div class="card h-100">
              {% if noticia.imagen %}
                <img src="{{ noticia.imagen.url }}" class="card-img-top" alt="Imagen de noticia">
              {% endif %}
              <div class="card-body">
                <h5 class="card-title">{{ noticia.titulo }}</h5>
                <p class="card-text">{{ noticia.cuerpo|truncatewords:20 }}</p>
                <p class="card-text"><small class="text-muted">Publicado el {{ noticia.fecha_publicacion }}</small></p>
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p>No hay noticias publicadas aún.</p>
      {% endif %}
    </div>
  </section>

</div>
{% endblock %}