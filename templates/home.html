{% extends 'base.html' %}
{% block title %}ASOPADEL BARINAS{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row g-5">
    <!-- Columna Izquierda: Torneos -->
    <div class="col-lg-4">
      <div class="home-section-header">
        <div class="icon-holder">
          <i class="ti ti-trophy fs-3"></i>
        </div>
        <div>
          <h2 class="section-title-modern">Torneos</h2>
          <span class="text-muted small">Temporada 2026</span>
        </div>
      </div>

      {% if torneos %}
      {% for torneo in torneos %}
      <div class="card mb-3 border-0 shadow-sm ranking-card">
        <div class="card-body p-4">
          <h5 class="h6 fw-bold mb-2">{{ torneo.nombre }}</h5>
          <p class="text-muted small mb-3">{{ torneo.descripcion|truncatechars:100 }}</p>
          <div class="d-flex align-items-center justify-content-between">
            <span class="badge bg-primary bg-opacity-10 text-primary small p-2">
              <i class="ti ti-calendar-event me-1"></i> {{ torneo.fecha_inicio|date:"d M" }}
            </span>
            <a href="{% url 'core:public_torneos_list' %}"
              class="btn-stats text-primary text-decoration-none fw-bold small">
              Ver detalles <i class="ti ti-arrow-right ms-1"></i>
            </a>
          </div>
        </div>
      </div>
      {% endfor %}
      {% else %}
      <div class="card border-0 p-4 text-center rounded-4" style="background: var(--color-light);">
        <p class="text-muted small mb-0">No hay torneos activos en este momento.</p>
      </div>
      {% endif %}
    </div>

    <!-- Columna Derecha: Partidos -->
    <div class="col-lg-8">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
        <div class="home-section-header mb-0">
          <div class="icon-holder" style="background: rgba(16, 185, 129, 0.1); color: #10B981;">
            <i class="ti ti-calendar-stats fs-3"></i>
          </div>
          <h2 class="section-title-modern">Últimos Partidos</h2>
        </div>
        <div class="d-flex gap-2">
          <button class="tag-filter-modern active" onclick="filterMatches('all', this)">Todos</button>
          <button class="tag-filter-modern" onclick="filterMatches('finalizado', this)">Resultados</button>
          <button class="tag-filter-modern" onclick="filterMatches('pendiente,confirmado', this)">Próximos</button>
        </div>
      </div>

      <div class="match-list">
        {% if partidos %}
        {% for partido in partidos %}
        <div class="match-card-modern mb-3 show" data-status="{{ partido.estado }}">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <span class="text-muted small fw-bold text-uppercase d-flex align-items-center gap-1">
              <i class="ti ti-clock"></i> {{ partido.fecha|date:"d M Y" }}
            </span>
            <span
              class="badge {% if partido.estado == 'finalizado' %}bg-success{% else %}bg-primary{% endif %} bg-opacity-10 {% if partido.estado == 'finalizado' %}text-success{% else %}text-primary{% endif %} px-3 py-2 rounded-pill small">
              {{ partido.get_estado_display }}
            </span>
          </div>

          <div class="row align-items-center g-0">
            <div class="col-5 text-end pe-4">
              <div class="fw-bold h5 mb-0 text-truncate">
                {% for j in partido.equipo1.all %}
                {{ j.first_name }}{% if not forloop.last %}, {% endif %}
                {% empty %}Equipo 1{% endfor %}
              </div>
            </div>

            <div class="col-2 text-center">
              {% if partido.estado == 'finalizado' %}
              <div class="h3 fw-bold mb-0 text-primary">{{ partido.marcador|default:"0-0" }}</div>
              {% else %}
              <div class="small fw-bold px-3 py-1 border rounded-pill bg-light text-muted">VS</div>
              {% endif %}
            </div>

            <div class="col-5 ps-4">
              <div class="fw-bold h5 mb-0 text-truncate">
                {% for j in partido.equipo2.all %}
                {{ j.first_name }}{% if not forloop.last %}, {% endif %}
                {% empty %}Equipo 2{% endfor %}
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="card border-0 p-5 text-center rounded-4" style="background: var(--color-light);">
          <i class="ti ti-mood-empty fs-1 text-muted mb-2"></i>
          <p class="text-muted mb-0">No hay partidos programados próximamente.</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="row g-5 mt-5">
    <!-- Ranking -->
    <div class="col-lg-5">
      <div class="home-section-header">
        <div class="icon-holder" style="background: rgba(245, 158, 11, 0.1); color: #F59E0B;">
          <i class="ti ti-star fs-3"></i>
        </div>
        <h3 class="section-title-modern">Top Ranking</h3>
      </div>

      <div class="card border-0 shadow-sm ranking-card overflow-hidden">
        <div class="card-body p-0">
          {% if ranking %}
          {% for jugador in ranking %}
          <div class="ranking-item-mini">
            <div class="d-flex align-items-center">
              <div class="rank-badge-mini me-3">{{ forloop.counter }}</div>
              <div>
                <div class="fw-bold">{{ jugador.get_full_name }}</div>
                <small class="text-muted text-uppercase" style="font-size:10px">
                  {% if jugador.get_categoria_jugador_display %}{{ jugador.get_categoria_jugador_display }}{% else %}Sin
                  Categoría{% endif %}
                </small>
              </div>
            </div>
            <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2 fs-6">{{ jugador.ranking|default:0 }}
              pts</span>
          </div>
          {% endfor %}
          <div class="p-4 text-center">
            <a href="{% url 'core:public_ranking_list' %}" class="btn btn-primary w-100 py-3 fw-bold rounded-pill">
              Ver Ranking Completo <i class="ti ti-arrow-right ms-1"></i>
            </a>
          </div>
          {% else %}
          <div class="p-5 text-center">
            <p class="text-muted small mb-0">No hay registros aún.</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Canchas -->
    <div class="col-lg-7">
      <div class="home-section-header">
        <div class="icon-holder" style="background: rgba(14, 165, 233, 0.1); color: #0EA5E9;">
          <i class="ti ti-ball-tennis fs-3"></i>
        </div>
        <h3 class="section-title-modern">Estado de Canchas</h3>
      </div>

      <div class="row g-4">
        {% for cancha in canchas|slice:":4" %}
        <div class="col-md-6">
          <div class="card border-0 shadow-sm h-100 ranking-card">
            <div class="card-body p-4">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                  <h6 class="fw-bold mb-1">{{ cancha.nombre }}</h6>
                  <small class="text-muted"><i class="ti ti-map-pin me-1"></i>{{ cancha.ubicacion }}</small>
                </div>
                <div class="d-flex align-items-center gap-2">
                  <span
                    class="status-indicator {% if cancha.estado == 'disponible' %}bg-success{% else %}bg-danger{% endif %} shadow-sm"></span>
                  <small
                    class="{% if cancha.estado == 'disponible' %}text-success{% else %}text-danger{% endif %} fw-bold">
                    {{ cancha.get_estado_display }}
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      <div class="mt-4">
        <a href="{% url 'core:public_canchas_list' %}"
          class="btn btn-outline-primary w-100 py-4 shadow-sm border-2 fw-bold d-flex align-items-center justify-content-center gap-2 rounded-4">
          <i class="ti ti-search fs-4"></i>
          <span>Consultar Disponibilidad de Canchas</span>
        </a>
      </div>
    </div>
  </div>
</div>


<script>
  function filterMatches(filter, btn) {
    document.querySelectorAll('.tag-filter').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const targets = filter.split(',');
    document.querySelectorAll('.match-card').forEach(match => {
      const status = match.getAttribute('data-status');
      if (filter === 'all' || targets.includes(status)) {
        match.style.display = 'block';
        setTimeout(() => match.style.opacity = '1', 10);
      } else {
        match.style.opacity = '0';
        setTimeout(() => match.style.display = 'none', 300);
      }
    });
  }
</script>

<style>
  .match-card {
    transition: opacity 0.3s ease;
  }

  .status-indicator {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    display: inline-block;
  }

  .flex-1 {
    flex: 1;
  }
</style>
{% endblock %}