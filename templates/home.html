{% extends 'base.html' %}
{% block title %}ASOPADEL BARINAS{% endblock %}

{% block content %}
<div class="container py-5">

  <div class="row g-5">
    <!-- Columna Izquierda: Torneos -->
    <div class="col-lg-4">
      <div class="d-flex align-items-baseline gap-2 mb-4">
        <h2 class="section-title h4 mb-0">üèÜ Torneos</h2>
        <span class="text-muted small">Temporada 2026</span>
      </div>

      {% if torneos %}
      {% for torneo in torneos %}
      <div class="card mb-3 border-0 shadow-sm">
        <div class="card-body p-3">
          <h5 class="h6 fw-bold mb-1">{{ torneo.nombre }}</h5>
          <p class="text-muted small mb-2">{{ torneo.descripcion|truncatechars:60 }}</p>
          <div class="d-flex align-items-center justify-content-between">
            <span class="badge bg-primary bg-opacity-10 text-primary small">{{ torneo.fecha_inicio|date:"d M" }}</span>
            <a href="{% url 'core:public_torneos_list' %}"
              class="btn btn-sm btn-link text-primary text-decoration-none fw-bold p-0">Ver detalles ‚Üí</a>
          </div>
        </div>
      </div>
      {% endfor %}
      {% else %}
      <div class="card border-0 bg-transparent opacity-75">
        <div class="card-body text-center py-4">
          <p class="text-muted small mb-0">No hay torneos activos</p>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Columna Derecha: Partidos -->
    <div class="col-lg-8">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
        <h2 class="section-title h4 mb-0">üìÖ √öltimos Partidos</h2>
        <div class="filter-tags">
          <button class="tag-filter active" onclick="filterMatches('all', this)">Todos</button>
          <button class="tag-filter" onclick="filterMatches('finalizado', this)">Resultados</button>
          <button class="tag-filter" onclick="filterMatches('pendiente,confirmado', this)">Pr√≥ximos</button>
        </div>
      </div>

      <div class="match-list">
        {% if partidos %}
        {% for partido in partidos %}
        <div class="match-card mb-3 show" data-status="{{ partido.estado }}">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-muted small fw-bold text-uppercase">{{ partido.fecha|date:"d M Y" }}</span>
            <span
              class="badge {% if partido.estado == 'finalizado' %}bg-success{% else %}bg-primary{% endif %} bg-opacity-10 {% if partido.estado == 'finalizado' %}text-success{% else %}text-primary{% endif %} small">
              {{ partido.get_estado_display }}
            </span>
          </div>

          <div class="d-flex align-items-center justify-content-between text-center">
            <div class="flex-1">
              <div class="fw-bold h6 mb-0">
                {% for j in partido.equipo1.all %}
                {{ j.first_name }}{% if not forloop.last %}, {% endif %}
                {% empty %}
                Equipo 1
                {% endfor %}
              </div>
            </div>

            <div class="px-3">
              {% if partido.estado == 'finalizado' %}
              <div class="match-score h5 mb-0 px-3">{{ partido.marcador|default:"0-0" }}</div>
              {% else %}
              <div class="text-muted small fw-bold px-3 py-1 border rounded-pill">VS</div>
              {% endif %}
            </div>

            <div class="flex-1">
              <div class="fw-bold h6 mb-0">
                {% for j in partido.equipo2.all %}
                {{ j.first_name }}{% if not forloop.last %}, {% endif %}
                {% empty %}
                Equipo 2
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="card border-0 bg-transparent opacity-75">
          <div class="card-body text-center py-5">
            <p class="text-muted mb-0">No hay partidos programados pr√≥ximamente.</p>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="row g-5 mt-4">
    <!-- Ranking -->
    <div class="col-lg-5">
      <h3 class="h5 fw-bold mb-4">‚≠ê Top Ranking</h3>
      <div class="card border-0 shadow-sm">
        <div class="card-body p-0">
          {% if ranking %}
          {% for jugador in ranking %}
          <div
            class="d-flex align-items-center justify-content-between p-3 {% if not forloop.last %}border-bottom{% endif %}">
            <div class="d-flex align-items-center">
              <span class="text-muted me-3 fw-bold small">{{ forloop.counter }}.</span>
              <div>
                <div class="fw-bold small">{{ jugador.get_full_name }}</div>
                <small class="text-muted text-uppercase" style="font-size:10px">
                  {% if jugador.get_categoria_jugador_display %}{{ jugador.get_categoria_jugador_display }}{% else %}Sin
                  Categor√≠a{% endif %}
                </small>
              </div>
            </div>
            <span class="badge bg-primary bg-opacity-10 text-primary">{{ jugador.ranking|default:0 }} pts</span>
          </div>
          {% endfor %}
          <div class="p-3 text-center border-top">
            <a href="{% url 'core:public_ranking_list' %}" class="btn btn-primary w-100 py-2 fw-bold">Ver Ranking
              Completo ‚Üí</a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Canchas -->
    <div class="col-lg-7">
      <h3 class="h5 fw-bold mb-4">üéæ Estado de Canchas</h3>
      <div class="row g-3">
        {% for cancha in canchas|slice:":4" %}
        <div class="col-md-6">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body p-3">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="fw-bold mb-0">{{ cancha.nombre }}</h6>
                <div class="d-flex align-items-center gap-1">
                  <span
                    class="status-indicator {% if cancha.estado == 'disponible' %}bg-success{% else %}bg-danger{% endif %}"></span>
                  <small
                    class="{% if cancha.estado == 'disponible' %}text-success{% else %}text-danger{% endif %} fw-bold"
                    style="font-size: 0.7rem;">
                    {{ cancha.get_estado_display }}
                  </small>
                </div>
              </div>
              <small class="text-muted d-block">{{ cancha.ubicacion }}</small>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      <div class="mt-4">
        <a href="{% url 'core:public_canchas_list' %}"
          class="btn btn-primary w-100 py-3 shadow-sm d-flex align-items-center justify-content-center gap-2">
          <span>Consultar Disponibilidad de Canchas</span>
          <i class="bi bi-arrow-right"></i>
          ‚Üí
        </a>
      </div>
    </div>
  </div>

</div>

<script>
  function filterMatches(filter, btn) {
    document.querySelectorAll('.tag-filter').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const targets = filter.split(',');
    document.querySelectorAll('.match-card').forEach(match => {
      const status = match.getAttribute('data-status');
      if (filter === 'all' || targets.includes(status)) {
        match.style.display = 'block';
        setTimeout(() => match.style.opacity = '1', 10);
      } else {
        match.style.opacity = '0';
        setTimeout(() => match.style.display = 'none', 300);
      }
    });
  }
</script>

<style>
  .match-card {
    transition: opacity 0.3s ease;
  }

  .status-indicator {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    display: inline-block;
  }

  .flex-1 {
    flex: 1;
  }
</style>
{% endblock %}