{% extends 'base.html' %}
{% load static %}
{% block title %}Registro de Usuario{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-12 col-md-10 col-lg-8">
      <div class="card shadow-lg border-0">
        <div class="card-header bg-primary text-white text-center py-4">
          <h2 class="mb-0">
            <i class="bi bi-person-plus-fill me-2"></i>Registro de Usuario
          </h2>
        </div>
        <div class="card-body p-4 p-md-5">
          {% if form.errors %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
              <strong>¡Error!</strong> Por favor corrige los siguientes errores:
              <ul class="mb-0 mt-2">
                {% for field in form %}
                  {% for error in field.errors %}
                    <li>{{ field.label }}: {{ error }}</li>
                  {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                  <li>{{ error }}</li>
                {% endfor %}
              </ul>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endif %}

          <form method="POST" action="{% url 'users:register' %}" novalidate>
            {% csrf_token %}
            
            <!-- Información Personal -->
            <div class="row g-3 mb-4">
              <div class="col-12">
                <h5 class="text-secondary mb-3">
                  <i class="bi bi-person-badge me-2"></i>Información Personal
                </h5>
              </div>
              
              <div class="col-12 col-md-6">
                <label for="{{ form.cedula.id_for_label }}" class="form-label fw-bold">
                  Cédula <span class="text-danger">*</span>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-card-text"></i></span>
                  <input type="text" 
                         name="{{ form.cedula.name }}" 
                         id="{{ form.cedula.id_for_label }}"
                         class="form-control {% if form.cedula.errors %}is-invalid{% endif %}" 
                         placeholder="Ej: 12345678"
                         value="{{ form.cedula.value|default:'' }}"
                         required>
                  {% if form.cedula.errors %}
                    <div class="invalid-feedback">{{ form.cedula.errors.0 }}</div>
                  {% endif %}
                </div>
                <small class="form-text text-muted">Sin puntos ni guiones</small>
              </div>

              <div class="col-12 col-md-6">
                <label for="{{ form.email.id_for_label }}" class="form-label fw-bold">
                  Email <span class="text-danger">*</span>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                  <input type="email" 
                         name="{{ form.email.name }}" 
                         id="{{ form.email.id_for_label }}"
                         class="form-control {% if form.email.errors %}is-invalid{% endif %}" 
                         placeholder="correo@ejemplo.com"
                         value="{{ form.email.value|default:'' }}"
                         required>
                  {% if form.email.errors %}
                    <div class="invalid-feedback">{{ form.email.errors.0 }}</div>
                  {% endif %}
                </div>
              </div>

              <div class="col-12 col-md-6">
                <label for="{{ form.first_name.id_for_label }}" class="form-label fw-bold">
                  Nombre <span class="text-danger">*</span>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-person"></i></span>
                  <input type="text" 
                         name="{{ form.first_name.name }}" 
                         id="{{ form.first_name.id_for_label }}"
                         class="form-control {% if form.first_name.errors %}is-invalid{% endif %}" 
                         placeholder="Tu nombre"
                         value="{{ form.first_name.value|default:'' }}"
                         required>
                  {% if form.first_name.errors %}
                    <div class="invalid-feedback">{{ form.first_name.errors.0 }}</div>
                  {% endif %}
                </div>
              </div>

              <div class="col-12 col-md-6">
                <label for="{{ form.last_name.id_for_label }}" class="form-label fw-bold">
                  Apellido <span class="text-danger">*</span>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-person"></i></span>
                  <input type="text" 
                         name="{{ form.last_name.name }}" 
                         id="{{ form.last_name.id_for_label }}"
                         class="form-control {% if form.last_name.errors %}is-invalid{% endif %}" 
                         placeholder="Tu apellido"
                         value="{{ form.last_name.value|default:'' }}"
                         required>
                  {% if form.last_name.errors %}
                    <div class="invalid-feedback">{{ form.last_name.errors.0 }}</div>
                  {% endif %}
                </div>
              </div>
            </div>
            
            <div class="row g-3 mb-4">
              <div class="col-12 col-md-6">
                <label for="{{ form.telefono.id_for_label }}" class="form-label fw-bold">
                  Teléfono <span class="text-danger">*</span>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-telephone"></i></span>
                  <input type="text"
                         name="{{ form.telefono.name }}"
                         id="{{ form.telefono.id_for_label }}"
                         class="form-control {% if form.telefono.errors %}is-invalid{% endif %}"
                         placeholder="Ej: 04141234567"
                         value="{{ form.telefono.value|default:'' }}"
                         required>
                  {% if form.telefono.errors %}
                    <div class="invalid-feedback">{{ form.telefono.errors.0 }}</div>
                  {% endif %}
                </div>
                <small class="form-text text-muted">Ej: 04141234567</small>
              </div>

            <!-- Contraseña -->
            <div class="row g-3 mb-4">
              <div class="col-12">
                <h5 class="text-secondary mb-3">
                  <i class="bi bi-shield-lock me-2"></i>Seguridad
                </h5>
              </div>

              <div class="col-12 col-md-6">
                <label for="{{ form.password1.id_for_label }}" class="form-label fw-bold">
                  Contraseña <span class="text-danger">*</span>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-lock"></i></span>
                  <input type="password" 
                         name="{{ form.password1.name }}" 
                         id="{{ form.password1.id_for_label }}"
                         class="form-control {% if form.password1.errors %}is-invalid{% endif %}" 
                         placeholder="Mínimo 8 caracteres"
                         required>
                  {% if form.password1.errors %}
                    <div class="invalid-feedback">{{ form.password1.errors.0 }}</div>
                  {% endif %}
                </div>
                <small class="form-text text-muted">Mínimo 8 caracteres</small>
              </div>

              <div class="col-12 col-md-6">
                <label for="{{ form.password2.id_for_label }}" class="form-label fw-bold">
                  Confirmar Contraseña <span class="text-danger">*</span>
                </label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-lock-fill"></i></span>
                  <input type="password" 
                         name="{{ form.password2.name }}" 
                         id="{{ form.password2.id_for_label }}"
                         class="form-control {% if form.password2.errors %}is-invalid{% endif %}" 
                         placeholder="Repite la contraseña"
                         required>
                  {% if form.password2.errors %}
                    <div class="invalid-feedback">{{ form.password2.errors.0 }}</div>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- Tipo de Usuario -->
            <div class="mb-4">
              <h5 class="text-secondary mb-3">
                <i class="bi bi-people me-2"></i>Tipo de Usuario
              </h5>
              <div class="row g-3">
                {% for value, label in form.role.field.choices %}
                <div class="col-12 col-sm-6">
                  <div class="card h-100 role-card {% if form.role.value == value %}selected{% endif %}" onclick="selectRole('{{ value }}')">
                    <div class="card-body text-center p-4">
                      <div class="role-icon mb-3">
                        {% if value == 'es_jugador' %}
                          <i class="bi bi-trophy-fill text-warning" style="font-size: 3rem;"></i>
                        {% elif value == 'es_arbitro' %}
                          <i class="bi bi-whistle text-info" style="font-size: 3rem;"></i>
                        {% endif %}
                      </div>
                      <h5 class="card-title mb-2">{{ label }}</h5>
                      <p class="card-text text-muted small mb-3">
                        {% if value == 'es_jugador' %}
                          Participa en torneos y competiciones
                        {% elif value == 'es_arbitro' %}
                          Arbitra partidos y eventos
                        {% endif %}
                      </p>
                      <div class="form-check d-flex justify-content-center">
                        <input class="form-check-input role-radio" 
                               type="radio" 
                               name="{{ form.role.name }}" 
                               id="role_{{ value }}" 
                               value="{{ value }}"
                               {% if form.role.value == value %}checked{% endif %}
                               required>
                        <label class="form-check-label visually-hidden" for="role_{{ value }}">
                          {{ label }}
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
              {% if form.role.errors %}
                <div class="text-danger mt-2">{{ form.role.errors.0 }}</div>
              {% endif %}
            </div>

            <!-- Botones -->
            <div class="d-grid gap-2 d-md-flex justify-content-md-between mt-4">
              <a href="{% url 'users:login' %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-2"></i>Volver al Login
              </a>
              <button type="submit" class="btn btn-primary btn-lg px-5">
                <i class="bi bi-check-circle me-2"></i>Registrarse
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Info adicional -->
      <div class="text-center mt-4">
        <p class="text-muted">
          ¿Ya tienes una cuenta? 
          <a href="{% url 'users:login' %}" class="text-decoration-none fw-bold">Inicia sesión aquí</a>
        </p>
      </div>
    </div>
  </div>
</div>

<style>
.role-card {
  cursor: pointer;
  transition: all 0.3s ease;
  border: 2px solid #dee2e6;
}

.role-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 16px rgba(0,0,0,0.1);
  border-color: var(--bs-primary);
}

.role-card.selected {
  border-color: var(--bs-primary);
  background-color: rgba(13, 110, 253, 0.05);
}

.role-icon {
  height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.role-radio {
  width: 1.5rem;
  height: 1.5rem;
  cursor: pointer;
}

@media (max-width: 576px) {
  .role-icon i {
    font-size: 2.5rem !important;
  }
  
  .card-body.p-4.p-md-5 {
    padding: 1.5rem !important;
  }
}
</style>

<script>
function selectRole(value) {
  // Remove selected class from all cards
  document.querySelectorAll('.role-card').forEach(card => {
    card.classList.remove('selected');
  });
  
  // Add selected class to clicked card
  event.currentTarget.classList.add('selected');
  
  // Check the radio button
  document.getElementById('role_' + value).checked = true;
}
</script>
{% endblock %}