{% extends 'base.html' %}
{% load static %}

{% block title %}Ranking de jugadores{% endblock %}

{% block content %}
<div class="ranking-container">
    <!-- Hero Section -->
    <div class="ranking-hero">
        <h1 class="ranking-title">Ranking de Jugadores</h1>
        <p class="ranking-subtitle">Los mejores talentos de ASOPADEL Barinas</p>
    </div>

    <!-- Filtros por categoría -->
    <div class="category-nav">
        {% for cat_value, cat_label in categorias %}
        <a href="?categoria={{ cat_value }}"
            class="category-link {% if categoria_actual == cat_value %}active{% endif %}">
            {{ cat_label }}
        </a>
        {% endfor %}
    </div>

    <!-- Tabla de ranking -->
    {% if jugadores %}
    <div class="card ranking-card">
        <div class="table-responsive">
            <table class="table table-premium align-middle">
                <thead>
                    <tr>
                        <th class="text-center" style="width: 100px;">Posición</th>
                        <th>Jugador</th>
                        <th class="text-center">Categoría</th>
                        <th class="text-center">Puntos</th>
                        <th class="text-center d-none d-md-table-cell">Partidos</th>
                        <th class="text-center d-none d-md-table-cell">Victorias</th>
                        <th class="text-center d-none d-md-table-cell">Derrotas</th>
                        <th class="text-center">% Victorias</th>
                    </tr>
                </thead>
                <tbody>
                    {% for jugador in jugadores %}
                    <tr>
                        <td class="text-center">
                            <div class="rank-badge-container">
                                {% if forloop.counter == 1 %}
                                <div class="rank-badge rank-1">1</div>
                                {% elif forloop.counter == 2 %}
                                <div class="rank-badge rank-2">2</div>
                                {% elif forloop.counter == 3 %}
                                <div class="rank-badge rank-3">3</div>
                                {% else %}
                                <div class="rank-badge rank-other">{{ forloop.counter }}</div>
                                {% endif %}
                            </div>
                        </td>
                        <td>
                            <a href="{% url 'core:player_public_profile' jugador.id %}"
                                class="text-decoration-none player-link">
                                <div class="player-meta">
                                    <div class="player-avatar">
                                        {{ jugador.first_name|first }}{{ jugador.last_name|first }}
                                    </div>
                                    <div class="d-flex flex-column">
                                        <span class="player-name">{{ jugador.get_full_name }}</span>
                                        <span class="player-cedula">ID: {{ jugador.cedula }}</span>
                                    </div>
                                </div>
                            </a>
                        </td>
                        <td class="text-center">
                            {% if jugador.categoria_jugador %}
                            <span class="badge bg-opacity-10 bg-primary text-primary category-tag">
                                {{ jugador.get_categoria_jugador_display }}
                            </span>
                            {% else %}
                            <span class="text-muted small">-</span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <span class="stat-value stat-puntos">{{ jugador.ranking|default:0 }}</span>
                        </td>
                        <td class="text-center d-none d-md-table-cell">
                            {% with estadistica=jugador.estadisticas.first %}
                            <span class="stat-value">{{ estadistica.partidos_jugados|default:0 }}</span>
                            {% endwith %}
                        </td>
                        <td class="text-center d-none d-md-table-cell text-success">
                            {% with estadistica=jugador.estadisticas.first %}
                            <span class="stat-value text-success">{{ estadistica.victorias|default:0 }}</span>
                            {% endwith %}
                        </td>
                        <td class="text-center d-none d-md-table-cell text-danger">
                            {% with estadistica=jugador.estadisticas.first %}
                            <span class="stat-value text-danger">{{ estadistica.derrotas|default:0 }}</span>
                            {% endwith %}
                        </td>
                        <td class="text-center">
                            {% with estadistica=jugador.estadisticas.first %}
                            {% if estadistica %}
                            <div class="d-flex flex-column align-items-center">
                                <span class="stat-value">{{ estadistica.promedio_victorias }}%</span>
                                <div class="progress mt-1" style="width: 50px; height: 4px;">
                                    <div class="progress-bar bg-primary" role="progressbar"
                                        style="width: {{ estadistica.promedio_victorias }}%"
                                        aria-valuenow="{{ estadistica.promedio_victorias }}" aria-valuemin="0"
                                        aria-valuemax="100"></div>
                                </div>
                            </div>
                            {% else %}
                            <span class="stat-value">0%</span>
                            {% endif %}
                            {% endwith %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="card border-0 shadow-sm text-center py-5">
        <div class="card-body">
            <h4 class="text-muted mb-3">No hay jugadores en el ranking</h4>
            <p class="text-muted">Aún no hay jugadores registrados o no hay partidos finalizados.</p>
        </div>
    </div>
    {% endif %}

</div>
{% endblock %}