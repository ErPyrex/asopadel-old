{% extends 'base.html' %}
{% load static %}
{% block title %}Gestión de Partidos | ASOPADEL{% endblock %}
{% block extra_head %}
    <style>
  /* Variables locales de estilo refinadas - ASOPADEL Modern Theme */
  :root {
    --aso-primary: #0ea5e9;
    --aso-primary-rgb: 14, 165, 233;
    --aso-secondary: #6366f1;
    --aso-secondary-rgb: 99, 102, 241;
    --card-bg-modern: rgba(15, 23, 42, 0.7);
    --border-aso: rgba(255, 255, 255, 0.1);
    --glass-effect: blur(16px) saturate(180%);
    --text-primary: #f8fafc;
    --text-muted: #94a3b8;
  }

  [data-bs-theme="light"] {
    --card-bg-modern: rgba(255, 255, 255, 0.85);
    --border-aso: rgba(0, 0, 0, 0.08);
    --text-primary: #0f172a;
    --text-muted: #64748b;
  }

  /* Animaciones suaves */
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes pulseGlow {
    0% { box-shadow: 0 0 0 0 rgba(var(--aso-primary-rgb), 0.4); }
    70% { box-shadow: 0 0 0 15px rgba(var(--aso-primary-rgb), 0); }
    100% { box-shadow: 0 0 0 0 rgba(var(--aso-primary-rgb), 0); }
  }

  .premium-header {
    background: linear-gradient(135deg, rgba(var(--aso-primary-rgb), 0.2) 0%, rgba(var(--aso-secondary-rgb), 0.1) 100%);
    backdrop-filter: var(--glass-effect);
    border-radius: 32px;
    padding: 3rem;
    margin-bottom: 3rem;
    border: 1px solid var(--border-aso);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    animation: fadeInUp 0.6s ease-out;
    position: relative;
    overflow: hidden;
  }

  .premium-header::after {
    content: '';
    position: absolute;
    top: -50%;
    right: -20%;
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(var(--aso-primary-rgb), 0.15) 0%, transparent 70%);
    filter: blur(40px);
    z-index: 0;
  }

  .filter-card {
    background: var(--card-bg-modern) !important;
    backdrop-filter: var(--glass-effect);
    border: 1px solid var(--border-aso) !important;
    border-radius: 28px !important;
    box-shadow: 0 20px 40px rgba(0,0,0,0.2) !important;
    animation: fadeInUp 0.7s ease-out;
    margin-top: -1.5rem;
    z-index: 2;
  }

  .form-label-premium {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-muted);
    margin-bottom: 0.75rem;
    display: block;
  }

  .aso-select {
    border-radius: 16px !important;
    padding: 0.85rem 1.25rem !important;
    background: rgba(255,255,255,0.05) !important;
    border: 1px solid var(--border-aso) !important;
    color: var(--text-primary) !important;
    font-weight: 500 !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
  }

  [data-bs-theme="light"] .aso-select {
    background: #ffffff !important;
    border: 1px solid #e2e8f0 !important;
  }

  .aso-select:focus {
    border-color: var(--aso-primary) !important;
    box-shadow: 0 0 0 4px rgba(var(--aso-primary-rgb), 0.2) !important;
    transform: translateY(-2px);
    background: rgba(255,255,255,0.08) !important;
  }

  /* Botones Premium Refinados */
  .btn-premium {
    border-radius: 16px !important;
    padding: 0.85rem 2rem !important;
    font-weight: 700 !important;
    font-size: 0.95rem !important;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    letter-spacing: 0.5px;
  }

  .btn-premium-primary {
    background: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%) !important;
    border: none !important;
    color: #ffffff !important;
    box-shadow: 0 12px 24px rgba(var(--aso-primary-rgb), 0.3);
  }

  .btn-premium-primary:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 18px 36px rgba(var(--aso-primary-rgb), 0.45);
    filter: brightness(1.1);
  }

  .btn-premium-outline {
    background: rgba(255, 255, 255, 0.05) !important;
    border: 1px solid var(--border-aso) !important;
    color: var(--text-primary) !important;
    backdrop-filter: blur(8px);
  }

  .btn-premium-outline:hover {
    background: rgba(var(--aso-primary-rgb), 0.1) !important;
    border-color: var(--aso-primary) !important;
    transform: translateY(-4px);
    color: var(--aso-primary) !important;
  }

  /* Table Styles Modern Elite */
  .table-container-premium {
    background: var(--card-bg-modern);
    border-radius: 32px;
    border: 1px solid var(--border-aso);
    box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.35);
    overflow: hidden;
    backdrop-filter: var(--glass-effect);
    animation: fadeInUp 0.8s ease-out;
  }

  .table-premium {
    margin-bottom: 0 !important;
    border-collapse: separate !important;
  }

  .table-premium thead th {
    background: rgba(15, 23, 42, 0.5) !important;
    color: var(--text-muted) !important;
    font-weight: 700 !important;
    text-transform: uppercase !important;
    font-size: 0.75rem !important;
    letter-spacing: 2px !important;
    padding: 1.75rem 1.5rem !important;
    border: none !important;
  }

  [data-bs-theme="light"] .table-premium thead th {
    background: rgba(241, 245, 249, 0.8) !important;
  }

  .table-premium tbody td {
    padding: 1.75rem 1.5rem !important;
    vertical-align: middle !important;
    border-bottom: 1px solid var(--border-aso) !important;
    transition: all 0.3s ease !important;
    color: var(--text-primary);
  }

  .table-premium tr:last-child td {
    border-bottom: none !important;
  }

  .table-premium tr:hover td {
    background: rgba(var(--aso-primary-rgb), 0.05) !important;
  }

  .match-event-name {
    font-size: 1.1rem;
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
  }

  /* Badges ASO Refined */
  .badge-aso {
    border-radius: 12px !important;
    padding: 0.65rem 1.1rem !important;
    font-weight: 800 !important;
    font-size: 0.7rem !important;
    text-transform: uppercase !important;
    letter-spacing: 1px !important;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .badge-pendiente { background: rgba(245, 158, 11, 0.15) !important; color: #fbbf24 !important; border: 1px solid rgba(245, 158, 11, 0.3) !important; }
  .badge-confirmado { background: rgba(14, 165, 233, 0.15) !important; color: #38bdf8 !important; border: 1px solid rgba(14, 165, 233, 0.3) !important; }
  .badge-finalizado { background: rgba(16, 185, 129, 0.15) !important; color: #34d399 !important; border: 1px solid rgba(16, 185, 129, 0.3) !important; }
  .badge-cancelado { background: rgba(239, 68, 68, 0.15) !important; color: #f87171 !important; border: 1px solid rgba(239, 68, 68, 0.3) !important; }

  /* Squad Visualization Refined */
  .squad-row {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.5rem;
  }
  .squad-row:last-child { margin-bottom: 0; }

  .squad-label {
    font-size: 0.65rem;
    font-weight: 900;
    width: 26px;
    height: 26px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    background: rgba(var(--aso-primary-rgb), 0.15);
    color: var(--aso-primary);
  }
  .squad-label.red {
    background: rgba(239, 68, 68, 0.15);
    color: #ef4444;
  }

  .player-pill {
    font-size: 0.8rem;
    font-weight: 600;
    padding: 0.35rem 0.9rem;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.04);
    border: 1px solid var(--border-aso);
    color: var(--text-primary);
    transition: all 0.2s ease;
  }
  .player-pill:hover {
    background: rgba(var(--aso-primary-rgb), 0.1);
    border-color: var(--aso-primary);
  }

  /* Action Buttons Group Refined */
  .action-btn {
    width: 44px;
    height: 44px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 12px;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    border: 1px solid rgba(255, 255, 255, 0.08);
    background: rgba(255, 255, 255, 0.03);
    color: var(--text-muted);
    backdrop-filter: blur(4px);
  }
  
  .action-btn:hover {
    transform: translateY(-4px) scale(1.1);
    color: white;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    border-color: rgba(255, 255, 255, 0.2);
    z-index: 5;
  }

  .btn-view:hover { background: rgba(14, 165, 233, 0.2) !important; color: #0ea5e9 !important; border-color: #0ea5e9 !important; }
  .btn-edit:hover { background: rgba(245, 158, 11, 0.2) !important; color: #f59e0b !important; border-color: #f59e0b !important; }
  
  /* Modern Competitors Layout - Vertical */
  .competitors-v2 {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0;
  }
  
  .team-v2 {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.3rem;
    width: 100%;
  }
  
  .vs-badge {
    font-size: 0.55rem;
    font-weight: 900;
    color: rgba(255,255,255,0.4);
    background: linear-gradient(135deg, rgba(14, 165, 233, 0.15), rgba(239, 68, 68, 0.15));
    padding: 0.25rem 0.6rem;
    border-radius: 6px;
    text-transform: uppercase;
    letter-spacing: 2px;
    border: 1px solid rgba(255,255,255,0.08);
  }

  .player-pill-v2 {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.06);
    padding: 0.35rem 0.75rem;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text-primary);
    white-space: nowrap;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
  }

  .player-pill-v2.team-1 { border-color: rgba(14, 165, 233, 0.3); background: rgba(14, 165, 233, 0.08); }
  .player-pill-v2.team-2 { border-color: rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.08); }
  
  /* Modal Global Overrides */
  .modal-content {
    border-radius: 32px !important;
    border: 1px solid var(--border-aso) !important;
    box-shadow: 0 40px 80px rgba(0,0,0,0.6) !important;
  }

  .empty-state {
    padding: 8rem 2rem;
    text-align: center;
    background: var(--card-bg-modern);
    border-radius: 40px;
    border: 2px dashed var(--border-aso);
    backdrop-filter: var(--glass-effect);
    animation: fadeInUp 0.6s ease-out;
  }

  /* Avatar Premium & Typography extensions */
  .avatar-premium {
    width: 48px;
    height: 48px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 800;
    font-size: 1.1rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  .fw-black { font-weight: 900; }
  .letter-spacing-1 { letter-spacing: 1.5px; }
  .hover-effect-light { transition: all 0.2s ease; border-radius: 12px; }
  .hover-effect-light:hover { background: rgba(255, 255, 255, 0.05); transform: translateX(5px); }
  .font-monospace { font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace; }

  .empty-icon-container {
    width: 140px;
    height: 140px;
    background: linear-gradient(135deg, rgba(var(--aso-primary-rgb), 0.15) 0%, rgba(var(--aso-secondary-rgb), 0.1) 100%);
    border-radius: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 2.5rem;
    border: 1px solid var(--border-aso);
    animation: pulseGlow 3s infinite;
  }

  .empty-icon-container i {
    font-size: 4rem;
    background: linear-gradient(135deg, #0ea5e9, #6366f1);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
  }
    </style>
{% endblock %}
{% block content %}
    <div class="container py-5">
        <!-- Encabezado Premium -->
        <div class="premium-header d-flex flex-wrap justify-content-between align-items-center gap-4">
            <div style="position: relative; z-index: 1;">
                <h1 class="display-5 fw-bold mb-2 d-flex align-items-center text-white">
                    <i class="ti ti-calendar-event me-3 text-primary animate__animated animate__pulse animate__infinite"></i>
                    Gestión de Partidos
                </h1>
                <p class="text-muted mb-0 fs-5">Administra, programa y supervisa todos los encuentros de ASOPADEL.</p>
            </div>
            <div style="position: relative; z-index: 1;">
                <button type="button"
                        class="btn btn-premium btn-premium-primary"
                        data-bs-toggle="modal"
                        data-bs-target="#createMatchModal">
                    <i class="ti ti-plus fs-4"></i> Crear Nuevo Partido
                </button>
            </div>
        </div>

        <!-- Barra de Filtros Glassmorphism -->
        <div class="card filter-card mb-5">
            <div class="card-body p-4">
                <form method="GET" class="row g-4 align-items-end">
                    <div class="col-lg-4">
                        <label for="torneo" class="form-label-premium">
                            <i class="ti ti-trophy me-2"></i>Filtrar por Torneo
                        </label>
                        <select name="torneo" id="torneo" class="form-select aso-select">
                            <option value="">Todos los torneos</option>
                            {% for torneo in torneos %}
                                <option value="{{ torneo.id }}" {% if torneo.selected %}selected{% endif %}>{{ torneo.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-lg-4">
                        <label for="estado" class="form-label-premium">
                            <i class="ti ti-activity me-2"></i>Filtrar por Estado
                        </label>
                        <select name="estado" id="estado" class="form-select aso-select">
                            <option value="">Todos los estados</option>
                            {% for estado_opcion in estados %}
                                <option value="{{ estado_opcion.value }}"
                                        {% if estado_opcion.selected %}selected{% endif %}>
                                    {{ estado_opcion.label }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-lg-4">
                        <div class="d-flex gap-3">
                            <button type="submit" class="btn btn-premium btn-premium-primary flex-fill">
                                <i class="ti ti-filter"></i> Aplicar Filtros
                            </button>
                            <a href="{% url 'core:admin_partidos_list' %}"
                               class="btn btn-premium btn-premium-outline flex-fill">
                                <i class="ti ti-refresh"></i> Limpiar
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Listado de Partidos con Estetica Elite -->
        {% if partidos %}
            <div class="table-container-premium table-responsive">
                <table class="table table-premium align-middle">
                    <thead>
                        <tr>
                            <th class="ps-4">Evento / Cancha</th>
                            <th>Fecha y Hora</th>
                            <th>Competidores (E1 vs E2)</th>
                            <th>Árbitro</th>
                            <th>Estado</th>
                            <th class="text-center">Resultado</th>
                            <th class="text-end pe-4">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for partido in partidos %}
                            <tr>
                                <td class="ps-4">
                                    <div class="match-event-name">{{ partido.torneo.nombre|default:"Casual / Amistoso" }}</div>
                                    <div class="text-muted small d-flex align-items-center">
                                        <i class="ti ti-map-pin me-2 text-primary"></i>{{ partido.cancha.nombre|default:"Sin sede asignada" }}
                                    </div>
                                </td>
                                <td>
                                    <div class="fw-bold text-white">{{ partido.fecha|date:"D, d M Y" }}</div>
                                    <div class="text-muted small d-flex align-items-center">
                                        <i class="ti ti-clock me-2 text-primary"></i>{{ partido.hora|time:"H:i" }}
                                    </div>
                                </td>
                                <td>
                                    <div class="competitors-v2">
                                        <!-- Equipo 1 arriba -->
                                        <div class="team-v2">
                                            {% for j in partido.equipo1.all %}
                                                <div class="player-pill-v2 team-1">
                                                    <i class="ti ti-user text-primary opacity-75" style="font-size: 0.75rem;"></i>
                                                    {{ j.get_full_name }}
                                                </div>
                                            {% empty %}
                                                <span class="text-muted small italic">Equipo 1 pendiente</span>
                                            {% endfor %}
                                        </div>
                                        <!-- VS centrado -->
                                        <div class="vs-badge">VS</div>
                                        <!-- Equipo 2 abajo -->
                                        <div class="team-v2">
                                            {% for j in partido.equipo2.all %}
                                                <div class="player-pill-v2 team-2">
                                                    <i class="ti ti-user text-danger opacity-75" style="font-size: 0.75rem;"></i>
                                                    {{ j.get_full_name }}
                                                </div>
                                            {% empty %}
                                                <span class="text-muted small italic">Equipo 2 pendiente</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    {% if partido.arbitro %}
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="bg-primary bg-opacity-10 p-2 rounded-circle">
                                                <i class="ti ti-user-star text-primary"></i>
                                            </div>
                                            <span class="fw-medium text-white">{{ partido.arbitro.get_full_name }}</span>
                                        </div>
                                    {% else %}
                                        <span class="text-muted small italic">Sin árbitro</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge badge-aso {% if partido.estado == 'pendiente' %}badge-pendiente{% elif partido.estado == 'confirmado' %}badge-confirmado{% elif partido.estado == 'finalizado' %}badge-finalizado{% elif partido.estado == 'cancelado' %}badge-cancelado{% endif %}">
                                        <i class="ti {% if partido.estado == 'pendiente' %}ti-calendar-time{% elif partido.estado == 'confirmado' %}ti-circle-check{% elif partido.estado == 'finalizado' %}ti-pennant{% elif partido.estado == 'cancelado' %}ti-circle-x{% endif %}"></i>
                                        {{ partido.get_estado_display }}
                                    </span>
                                </td>
                                <td class="text-center">
                                    {% if partido.estado == 'finalizado' %}
                                        <div class="fw-black fs-3 text-primary font-monospace">{{ partido.marcador }}</div>
                                    {% else %}
                                        <div class="text-muted fw-bold">-- : --</div>
                                    {% endif %}
                                </td>
                                 <td class="text-end pe-4">
                                     <div class="d-flex justify-content-end gap-3">
                                         <!-- Ver detalle (abre modal) -->
                                         <button type="button"
                                                 class="action-btn btn-view"
                                                 title="Ver detalles del encuentro"
                                                 data-bs-toggle="modal"
                                                 data-bs-target="#detailModal{{ partido.id }}">
                                             <i class="ti ti-list-details"></i>
                                         </button>
                                         
                                         {% if request.user.is_staff or request.user.is_superuser %}
                                             <!-- Editar (Programación) -->
                                             <button type="button"
                                                     class="action-btn btn-edit"
                                                     title="Editar programación"
                                                     data-bs-toggle="modal"
                                                     data-bs-target="#editModal{{ partido.id }}">
                                                 <i class="ti ti-pencil"></i>
                                             </button>
                                             
                                             {% if partido.estado == 'pendiente' or partido.estado == 'confirmado' %}
                                                 <!-- Registrar resultado -->
                                                 <button type="button"
                                                         class="action-btn"
                                                         title="Registrar Resultado"
                                                         style="background: rgba(16, 185, 129, 0.08); color: #10b981; border-color: rgba(16, 185, 129, 0.15)"
                                                         data-bs-toggle="modal"
                                                         data-bs-target="#resultModal{{ partido.id }}">
                                                     <i class="ti ti-pennant"></i>
                                                 </button>
                                                 
                                                 <!-- Cancelar partido -->
                                                 <button type="button"
                                                         class="action-btn"
                                                         title="Cancelar Partido"
                                                         style="background: rgba(239, 68, 68, 0.08); color: #ef4444; border-color: rgba(239, 68, 68, 0.15)"
                                                         data-bs-toggle="modal"
                                                         data-bs-target="#cancelModal{{ partido.id }}">
                                                     <i class="ti ti-circle-x"></i>
                                                 </button>
                                             {% elif partido.estado == 'finalizado' %}
                                                 <!-- Editar resultado: admins siempre, árbitros max 2 ediciones -->
                                                 {% if request.user.is_staff or request.user.is_superuser or partido.ediciones_resultado < 2 %}
                                                     <button type="button"
                                                             class="action-btn"
                                                             title="Editar Resultado{% if not request.user.is_staff and not request.user.is_superuser %} ({{ 2|add:partido.ediciones_resultado|default:2 }} restantes){% endif %}"
                                                             style="background: rgba(245, 158, 11, 0.08); color: #f59e0b; border-color: rgba(245, 158, 11, 0.15)"
                                                             data-bs-toggle="modal"
                                                             data-bs-target="#editResultModal{{ partido.id }}">
                                                         <i class="ti ti-history"></i>
                                                     </button>
                                                 {% else %}
                                                     <!-- Árbitro sin ediciones restantes -->
                                                     <span class="action-btn"
                                                           title="Sin correcciones disponibles"
                                                           style="background: rgba(100, 100, 100, 0.1); color: #64748b; cursor: not-allowed">
                                                         <i class="ti ti-lock"></i>
                                                     </span>
                                                 {% endif %}
                                             {% endif %}
                                         {% endif %}
                                     </div>
                                 </td>
                            </tr>
                            <!-- Modal Ver Detalles del Partido -->
                            <div class="modal fade"
                                 id="detailModal{{ partido.id }}"
                                 tabindex="-1"
                                 aria-hidden="true">
                                <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                                    <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden"
                                         style="background: #0f172a">
                                        <!-- Header -->
                                        <div class="modal-header py-3 border-0"
                                             style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)">
                                            <h5 class="modal-title fw-bold text-white d-flex align-items-center">
                                                <div class="bg-white bg-opacity-25 rounded-circle p-2 me-3 d-flex align-items-center justify-content-center"
                                                     style="width: 36px;
                                                            height: 36px">
                                                    <i class="ti ti-ball-tennis fs-5"></i>
                                                </div>
                                                Detalles del Partido
                                            </h5>
                                            <button type="button"
                                                    class="btn-close btn-close-white"
                                                    data-bs-dismiss="modal"
                                                    aria-label="Cerrar"></button>
                                        </div>
                                        <div class="modal-body p-4 p-md-5" style="background: #0f172a;">
                                            <!-- Torneo / Evento -->
                                            <div class="mb-4 p-4 rounded-4"
                                                 style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(37, 99, 235, 0.05));
                                                        border: 1px solid rgba(59, 130, 246, 0.2)">
                                                <div class="d-flex align-items-center gap-4">
                                                    <div class="bg-primary bg-opacity-10 p-3 rounded-circle border border-primary border-opacity-25">
                                                        <i class="ti ti-trophy text-primary fs-2"></i>
                                                    </div>
                                                    <div>
                                                        <div class="text-muted small text-uppercase fw-bold letter-spacing-1">Campeonato / Categoría</div>
                                                        <div class="text-white fw-bold fs-4">{{ partido.torneo.nombre|default:"Partido Casual / Amistoso" }}</div>
                                                        {% if partido.torneo.categoria %}
                                                            <div class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25 mt-1">
                                                                {{ partido.torneo.categoria.nombre }}
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Información del Encuentro -->
                                            <div class="row g-4 mb-5">
                                                <div class="col-md-4">
                                                    <div class="p-4 rounded-4 h-100" style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08)">
                                                        <div class="text-muted small text-uppercase fw-bold mb-2">
                                                            <i class="ti ti-calendar-event me-2 text-primary"></i> Fecha
                                                        </div>
                                                        <div class="text-white fw-bold fs-5">{{ partido.fecha|date:"D, d M Y" }}</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="p-4 rounded-4 h-100" style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08)">
                                                        <div class="text-muted small text-uppercase fw-bold mb-2">
                                                            <i class="ti ti-clock me-2 text-primary"></i> Hora
                                                        </div>
                                                        <div class="text-white fw-bold fs-5">{{ partido.hora|time:"H:i" }} <span class="text-muted small fw-normal">hs</span></div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="p-4 rounded-4 h-100" style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08)">
                                                        <div class="text-muted small text-uppercase fw-bold mb-2">
                                                            <i class="ti ti-map-pin me-2 text-primary"></i> Cancha
                                                        </div>
                                                        <div class="text-white fw-bold fs-5">{{ partido.cancha.nombre|default:"Por definir" }}</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Duelo de Titanes -->
                                            <div class="mb-5">
                                                <h6 class="text-muted small text-uppercase fw-bold mb-4 d-flex align-items-center">
                                                    <i class="ti ti-swords me-2 fs-5 text-primary"></i> Enfoque de la Competencia
                                                </h6>
                                                <div class="row g-4">
                                                    <!-- Equipo 1 -->
                                                    <div class="col-md-6">
                                                        <div class="p-4 rounded-4 h-100 shadow-sm" 
                                                             style="background: linear-gradient(135deg, rgba(14, 165, 233, 0.1), rgba(14, 165, 233, 0.02)); 
                                                                    border: 1px solid rgba(14, 165, 233, 0.25)">
                                                            <div class="d-flex justify-content-between align-items-center mb-4">
                                                                <span class="fw-black text-primary fs-5">EQUIPO 1</span>
                                                                {% if partido.equipo_ganador == 1 %}
                                                                    <span class="badge rounded-pill bg-success bg-opacity-10 text-success border border-success border-opacity-25 px-3 py-2">
                                                                        <i class="ti ti-crown-filled me-1"></i> VICTORIA
                                                                    </span>
                                                                {% endif %}
                                                            </div>
                                                            <div class="d-flex flex-column gap-3">
                                                                {% for jugador in partido.equipo1.all %}
                                                                    <div class="d-flex align-items-center gap-3 p-2 rounded-3 hover-effect-light">
                                                                        <div class="avatar-premium bg-primary text-white">
                                                                            {{ jugador.first_name|first }}{{ jugador.last_name|first }}
                                                                        </div>
                                                                        <div>
                                                                            <div class="text-white fw-bold">{{ jugador.get_full_name }}</div>
                                                                            <div class="d-flex align-items-center gap-2">
                                                                                <span class="text-primary small fw-bold">Puntos: {{ jugador.ranking|default:0 }}</span>
                                                                                <div class="vr bg-primary opacity-25" style="height: 10px;"></div>
                                                                                <span class="text-muted small">{{ jugador.categoria_jugador|title|default:"Principiante" }}</span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                {% empty %}
                                                                    <div class="text-muted small italic p-3 text-center border border-dashed border-aso rounded-3">CUPOS DISPONIBLES</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- Equipo 2 -->
                                                    <div class="col-md-6">
                                                        <div class="p-4 rounded-4 h-100 shadow-sm" 
                                                             style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.02)); 
                                                                    border: 1px solid rgba(239, 68, 68, 0.25)">
                                                            <div class="d-flex justify-content-between align-items-center mb-4">
                                                                <span class="fw-black text-danger fs-5">EQUIPO 2</span>
                                                                {% if partido.equipo_ganador == 2 %}
                                                                    <span class="badge rounded-pill bg-success bg-opacity-10 text-success border border-success border-opacity-25 px-3 py-2">
                                                                        <i class="ti ti-crown-filled me-1"></i> VICTORIA
                                                                    </span>
                                                                {% endif %}
                                                            </div>
                                                            <div class="d-flex flex-column gap-3">
                                                                {% for jugador in partido.equipo2.all %}
                                                                    <div class="d-flex align-items-center gap-3 p-2 rounded-3 hover-effect-light">
                                                                        <div class="avatar-premium bg-danger text-white">
                                                                            {{ jugador.first_name|first }}{{ jugador.last_name|first }}
                                                                        </div>
                                                                        <div>
                                                                            <div class="text-white fw-bold">{{ jugador.get_full_name }}</div>
                                                                            <div class="d-flex align-items-center gap-2">
                                                                                <span class="text-danger small fw-bold">Puntos: {{ jugador.ranking|default:0 }}</span>
                                                                                <div class="vr bg-danger opacity-25" style="height: 10px;"></div>
                                                                                <span class="text-muted small">{{ jugador.categoria_jugador|title|default:"Principiante" }}</span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                {% empty %}
                                                                    <div class="text-muted small italic p-3 text-center border border-dashed border-aso rounded-3">CUPOS DISPONIBLES</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Oficiales y Resultados -->
                                            <div class="row g-4">
                                                <div class="col-md-6">
                                                    <div class="h-100 p-4 rounded-4" style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08)">
                                                        <div class="text-muted small text-uppercase fw-bold mb-3 d-flex align-items-center">
                                                            <i class="ti ti-gavel me-2 text-warning"></i> Autoridad del Encuentro
                                                        </div>
                                                        {% if partido.arbitro %}
                                                            <div class="d-flex align-items-center gap-3">
                                                                <div class="avatar-premium bg-warning text-dark">
                                                                    {{ partido.arbitro.first_name|first }}{{ partido.arbitro.last_name|first }}
                                                                </div>
                                                                <div>
                                                                    <div class="text-white fw-bold">{{ partido.arbitro.get_full_name }}</div>
                                                                    <div class="text-muted small">Árbitro Federado</div>
                                                                </div>
                                                            </div>
                                                        {% else %}
                                                            <div class="text-muted italic py-2">Sin arbitraje asignado para este duelo.</div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="h-100 p-4 rounded-4 text-center d-flex flex-column justify-content-center" 
                                                         style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05)); 
                                                                border: 1px solid rgba(16, 185, 129, 0.25)">
                                                        <div class="text-muted small text-uppercase fw-bold mb-2">Marcador Final</div>
                                                        {% if partido.estado == 'finalizado' %}
                                                            <div class="text-white fw-black display-6 font-monospace">{{ partido.marcador }}</div>
                                                        {% else %}
                                                            <div class="badge bg-warning bg-opacity-10 text-warning px-4 py-2 mt-2">
                                                                EN ESPERA DE RESULTADO
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Footer -->
                                        <div class="modal-footer border-0 py-3 px-4" style="background: rgba(0,0,0,0.2)">
                                            {% if request.user.is_staff or request.user.is_superuser %}
                                                <button type="button"
                                                        class="btn btn-warning px-4 py-2"
                                                        data-bs-dismiss="modal"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#editModal{{ partido.id }}">
                                                    <i class="ti ti-edit me-2"></i>Editar Partido
                                                </button>
                                            {% endif %}
                                            <button type="button"
                                                    class="btn btn-secondary px-4 py-2"
                                                    data-bs-dismiss="modal">
                                                <i class="ti ti-x me-2"></i>Cerrar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Modal Editar Partido -->
                            <div class="modal fade"
                                 id="editModal{{ partido.id }}"
                                 tabindex="-1"
                                 aria-hidden="true">
                                <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                                    <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden"
                                         style="background: #0f172a">
                                        <!-- Header -->
                                        <div class="modal-header py-3 border-0"
                                             style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%)">
                                            <h5 class="modal-title fw-bold text-white d-flex align-items-center">
                                                <div class="bg-white bg-opacity-25 rounded-circle p-2 me-3 d-flex align-items-center justify-content-center"
                                                     style="width: 36px;
                                                            height: 36px">
                                                    <i class="ti ti-edit fs-5"></i>
                                                </div>
                                                Editar Partido
                                            </h5>
                                            <button type="button"
                                                    class="btn-close btn-close-white"
                                                    data-bs-dismiss="modal"
                                                    aria-label="Cerrar"></button>
                                        </div>
                                        <div class="modal-body p-4 p-md-5" style="background: #0f172a;">
                                            <form action="{% url 'core:admin_edit_match' partido.id %}" method="POST">
                                                {% csrf_token %}
                                                <!-- Info del partido -->
                                                <div class="mb-4 p-3 rounded-3"
                                                     style="background: rgba(255,255,255,0.03);
                                                            border: 1px solid rgba(255,255,255,0.08)">
                                                    <div class="d-flex align-items-center gap-3">
                                                        <i class="ti ti-info-circle text-warning fs-4"></i>
                                                        <div>
                                                            <div class="text-white fw-bold">{{ partido.torneo.nombre|default:"Partido Casual" }}</div>
                                                            <small class="text-muted">Creado el {{ partido.fecha|date:"d M, Y" }}</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- Tipo de Partido -->
                                                <div class="mb-4">
                                                    <div class="form-check form-switch d-flex align-items-center gap-3 p-3 rounded-3"
                                                         style="background: rgba(255,255,255,0.03);
                                                                border: 1px solid rgba(255,255,255,0.08)">
                                                        <input class="form-check-input"
                                                               type="checkbox"
                                                               role="switch"
                                                               id="edit_es_casual_{{ partido.id }}"
                                                               name="es_casual"
                                                               style="width: 3rem;
                                                                      height: 1.5rem"
                                                               {% if not partido.torneo %}checked{% endif %}>
                                                        <label class="form-check-label text-white fw-bold"
                                                               for="edit_es_casual_{{ partido.id }}">
                                                            <i class="ti ti-ball-tennis me-2 text-warning"></i>Partido Casual / Amistoso
                                                        </label>
                                                    </div>
                                                </div>
                                                <!-- Torneo -->
                                                <div class="mb-4"
                                                     id="editTorneoContainer{{ partido.id }}"
                                                     {% if not partido.torneo %}style="opacity: 0.4; pointer-events: none;"{% endif %}>
                                                    <label class="form-label fw-bold text-muted small text-uppercase mb-2">Torneo</label>
                                                    <div class="input-group modern-input-group-modal">
                                                        <span class="input-group-text border-0 ps-3 bg-transparent"><i class="ti ti-trophy text-warning"></i></span>
                                                        <select name="torneo"
                                                                id="edit_torneo_{{ partido.id }}"
                                                                class="form-select border-0 py-2 bg-transparent text-white">
                                                            <option value="">Seleccione un Torneo</option>
                                                            {% for t in torneos_modal %}
                                                                <option value="{{ t.id }}"
                                                                        {% if partido.torneo.id == t.id %}selected{% endif %}>
                                                                    {{ t.nombre }}
                                                                </option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row g-4">
                                                    <!-- Cancha -->
                                                    <div class="col-md-6">
                                                        <label class="form-label fw-bold text-muted small text-uppercase mb-2">Cancha</label>
                                                        <div class="input-group modern-input-group-modal">
                                                            <span class="input-group-text border-0 ps-3 bg-transparent"><i class="ti ti-map-pin text-warning"></i></span>
                                                            <select name="cancha"
                                                                    class="form-select border-0 py-2 bg-transparent text-white"
                                                                    required>
                                                                <option value="">Seleccione una cancha</option>
                                                                {% for c in canchas %}
                                                                    <option value="{{ c.id }}"
                                                                            {% if partido.cancha.id == c.id %}selected{% endif %}>
                                                                        {{ c.nombre }}
                                                                    </option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <!-- Fecha -->
                                                    <div class="col-md-6">
                                                        <label class="form-label fw-bold text-muted small text-uppercase mb-2">Fecha del Partido</label>
                                                        <div class="input-group modern-input-group-modal">
                                                            <span class="input-group-text border-0 ps-3 bg-transparent"><i class="ti ti-calendar text-warning"></i></span>
                                                            <input type="date"
                                                                   name="fecha"
                                                                   class="form-control border-0 py-2 bg-transparent text-white"
                                                                   value="{{ partido.fecha|date:'Y-m-d' }}"
                                                                   required>
                                                        </div>
                                                    </div>
                                                    <!-- Hora -->
                                                    <div class="col-md-6">
                                                        <label class="form-label fw-bold text-muted small text-uppercase mb-2">Horario</label>
                                                        <div class="input-group modern-input-group-modal">
                                                            <span class="input-group-text border-0 ps-3 bg-transparent"><i class="ti ti-clock text-warning"></i></span>
                                                            <select name="hora"
                                                                    class="form-select border-0 py-2 bg-transparent text-white"
                                                                    required>
                                                                {% for valor, etiqueta in horarios %}
                                                                    <option value="{{ valor }}"
                                                                            {% if partido.hora|time:'H:i' == valor %}selected{% endif %}>
                                                                        {{ etiqueta }}
                                                                    </option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <!-- Árbitro -->
                                                    <div class="col-md-6">
                                                        <label class="form-label fw-bold text-muted small text-uppercase mb-2">Árbitro (Opcional)</label>
                                                        <div class="input-group modern-input-group-modal">
                                                            <span class="input-group-text border-0 ps-3 bg-transparent"><i class="ti ti-user-check text-warning"></i></span>
                                                            <select name="arbitro"
                                                                    class="form-select border-0 py-2 bg-transparent text-white">
                                                                <option value="">Sin árbitro asignado</option>
                                                                {% for a in arbitros %}
                                                                    <option value="{{ a.id }}"
                                                                            {% if partido.arbitro.id == a.id %}selected{% endif %}>
                                                                        {{ a.first_name }} {{ a.last_name }}
                                                                    </option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- Separador Visual -->
                                                <div class="my-4 py-3">
                                                    <div class="d-flex align-items-center gap-3">
                                                        <div class="flex-grow-1"
                                                             style="height: 1px;
                                                                    background: rgba(255,255,255,0.1)"></div>
                                                        <span class="text-muted small text-uppercase fw-bold"><i class="ti ti-users me-2"></i>Equipos</span>
                                                        <div class="flex-grow-1"
                                                             style="height: 1px;
                                                                    background: rgba(255,255,255,0.1)"></div>
                                                    </div>
                                                </div>
                                                <div class="row g-4">
                                                    <!-- Equipo 1 -->
                                                    <div class="col-md-6">
                                                        <div class="p-3 rounded-3"
                                                             style="background: rgba(14, 165, 233, 0.08);
                                                                    border: 1px solid rgba(14, 165, 233, 0.2)">
                                                            <h6 class="fw-bold text-primary mb-3">
                                                                <i class="ti ti-shield me-2"></i>Equipo 1
                                                            </h6>
                                                            <div class="mb-3">
                                                                <label class="form-label text-muted small">Jugador 1 *</label>
                                                                <select name="equipo1_jugador1"
                                                                        class="form-select form-select-sm bg-dark border-0 text-white"
                                                                        required>
                                                                    <option value="">Seleccione jugador</option>
                                                                    {% for j in jugadores %}
                                                                        <option value="{{ j.id }}"
                                                                                {% if j in partido.equipo1.all %}selected{% endif %}>
                                                                            {{ j.first_name }} {{ j.last_name }} ({{ j.cedula }})
                                                                        </option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                            <div>
                                                                <label class="form-label text-muted small">Jugador 2 (Dobles)</label>
                                                                <select name="equipo1_jugador2"
                                                                        class="form-select form-select-sm bg-dark border-0 text-white">
                                                                    <option value="">Sin segundo jugador</option>
                                                                    {% for j in jugadores %}
                                                                        <option value="{{ j.id }}"
                                                                                {% if partido.equipo1.count > 1 and j == partido.equipo1.all.1 %}selected{% endif %}>
                                                                            {{ j.first_name }} {{ j.last_name }} ({{ j.cedula }})
                                                                        </option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- Equipo 2 -->
                                                    <div class="col-md-6">
                                                        <div class="p-3 rounded-3"
                                                             style="background: rgba(239, 68, 68, 0.08);
                                                                    border: 1px solid rgba(239, 68, 68, 0.2)">
                                                            <h6 class="fw-bold text-danger mb-3">
                                                                <i class="ti ti-shield me-2"></i>Equipo 2
                                                            </h6>
                                                            <div class="mb-3">
                                                                <label class="form-label text-muted small">Jugador 1 *</label>
                                                                <select name="equipo2_jugador1"
                                                                        class="form-select form-select-sm bg-dark border-0 text-white"
                                                                        required>
                                                                    <option value="">Seleccione jugador</option>
                                                                    {% for j in jugadores %}
                                                                        <option value="{{ j.id }}"
                                                                                {% if j in partido.equipo2.all %}selected{% endif %}>
                                                                            {{ j.first_name }} {{ j.last_name }} ({{ j.cedula }})
                                                                        </option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                            <div>
                                                                <label class="form-label text-muted small">Jugador 2 (Dobles)</label>
                                                                <select name="equipo2_jugador2"
                                                                        class="form-select form-select-sm bg-dark border-0 text-white">
                                                                    <option value="">Sin segundo jugador</option>
                                                                    {% for j in jugadores %}
                                                                        <option value="{{ j.id }}"
                                                                                {% if partido.equipo2.count > 1 and j == partido.equipo2.all.1 %}selected{% endif %}>
                                                                            {{ j.first_name }} {{ j.last_name }} ({{ j.cedula }})
                                                                        </option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- Botones de Acción -->
                                                <div class="d-grid gap-3 mt-5">
                                                    <button type="submit"
                                                            class="btn btn-lg rounded-pill fw-bold py-3 shadow-sm"
                                                            style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
                                                                   color: white">
                                                        <i class="ti ti-device-floppy me-2"></i>Guardar Cambios
                                                    </button>
                                                    <button type="button"
                                                            class="btn btn-link text-muted fw-bold text-decoration-none shadow-none"
                                                            data-bs-dismiss="modal">Cancelar</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Modal Cancelar Partido -->
                            <div class="modal fade"
                                 id="cancelModal{{ partido.id }}"
                                 tabindex="-1"
                                 aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden"
                                         style="background: #0f172a">
                                        <div class="modal-header py-3 border-0"
                                             style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%)">
                                            <h5 class="modal-title fw-bold text-white d-flex align-items-center">
                                                <div class="bg-white bg-opacity-25 rounded-circle p-2 me-3 d-flex align-items-center justify-content-center"
                                                     style="width: 36px;
                                                            height: 36px">
                                                    <i class="ti ti-ban fs-5"></i>
                                                </div>
                                                Cancelar Partido
                                            </h5>
                                            <button type="button"
                                                    class="btn-close btn-close-white"
                                                    data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body p-4" style="background: #0f172a;">
                                            <div class="text-center mb-4">
                                                <div class="bg-danger bg-opacity-10 rounded-circle p-4 d-inline-flex mb-3">
                                                    <i class="ti ti-alert-triangle text-danger" style="font-size: 3rem;"></i>
                                                </div>
                                                <h5 class="text-white fw-bold">¿Cancelar este partido?</h5>
                                                <p class="text-muted">Esta acción marcará el partido como cancelado. No se efectuará.</p>
                                            </div>
                                            <div class="p-3 rounded-3 mb-4"
                                                 style="background: rgba(255,255,255,0.03)">
                                                <div class="text-muted small">
                                                    Partido del <strong class="text-white">{{ partido.fecha|date:"d M, Y" }}</strong>
                                                </div>
                                                <div class="text-white fw-bold">{{ partido.torneo.nombre|default:"Partido Casual" }}</div>
                                            </div>
                                        </div>
                                        <div class="modal-footer border-0 p-4 gap-2" style="background: #0f172a;">
                                            <button type="button"
                                                    class="btn btn-outline-secondary flex-fill rounded-pill"
                                                    data-bs-dismiss="modal">Volver</button>
                                            <form method="POST"
                                                  action="{% url 'core:admin_cancel_match' partido.id %}"
                                                  class="flex-fill">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-danger w-100 rounded-pill fw-bold">
                                                    <i class="ti ti-ban me-2"></i>Cancelar Partido
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Modal Registrar Resultado -->
                            <div class="modal fade"
                                 id="resultModal{{ partido.id }}"
                                 tabindex="-1"
                                 aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden"
                                         style="background: #0f172a">
                                        <div class="modal-header py-3 border-0"
                                             style="background: linear-gradient(135deg, #10b981 0%, #059669 100%)">
                                            <h5 class="modal-title fw-bold text-white d-flex align-items-center">
                                                <div class="bg-white bg-opacity-25 rounded-circle p-2 me-3 d-flex align-items-center justify-content-center"
                                                     style="width: 36px;
                                                            height: 36px">
                                                    <i class="ti ti-trophy fs-5"></i>
                                                </div>
                                                Registrar Resultado
                                            </h5>
                                            <button type="button"
                                                    class="btn-close btn-close-white"
                                                    data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body p-4" style="background: #0f172a;">
                                            <form method="POST"
                                                  action="{% url 'core:admin_record_result' partido.id %}"
                                                  id="resultForm{{ partido.id }}">
                                                {% csrf_token %}
                                                <!-- Info del partido -->
                                                <div class="p-3 rounded-3 mb-4"
                                                     style="background: rgba(255,255,255,0.03)">
                                                    <div class="text-muted small">{{ partido.fecha|date:"d M, Y" }} · {{ partido.hora|time:"H:i" }}</div>
                                                    <div class="text-white fw-bold">{{ partido.torneo.nombre|default:"Partido Casual" }}</div>
                                                </div>
                                                <!-- Marcador -->
                                                <div class="mb-4">
                                                    <label class="form-label fw-bold text-muted small text-uppercase mb-2">Marcador</label>
                                                    <div class="input-group modern-input-group-modal">
                                                        <span class="input-group-text border-0 ps-3 bg-transparent"><i class="ti ti-numbers text-success"></i></span>
                                                        <input type="text"
                                                               name="marcador"
                                                               class="form-control border-0 py-2 bg-transparent text-white"
                                                               placeholder="Ej: 6-4, 6-3 o 2-1"
                                                               required
                                                               pattern="^(\d+-\d+)(,?\s*\d+-\d+)*$">
                                                    </div>
                                                    <small class="text-muted">Formato: Sets (6-4, 6-3) o puntos (2-1)</small>
                                                </div>
                                                <!-- Equipo Ganador -->
                                                <div class="mb-4">
                                                    <label class="form-label fw-bold text-muted small text-uppercase mb-2">Equipo Ganador</label>
                                                    <div class="row g-3">
                                                        <div class="col-6">
                                                            <input type="radio"
                                                                   class="btn-check"
                                                                   name="equipo_ganador"
                                                                   id="eq1_{{ partido.id }}"
                                                                   value="1"
                                                                   required>
                                                            <label class="btn btn-outline-primary w-100 py-3 rounded-3"
                                                                   for="eq1_{{ partido.id }}">
                                                                <i class="ti ti-shield d-block mb-1" style="font-size: 1.5rem;"></i>
                                                                <span class="fw-bold">Equipo 1</span>
                                                            </label>
                                                        </div>
                                                        <div class="col-6">
                                                            <input type="radio"
                                                                   class="btn-check"
                                                                   name="equipo_ganador"
                                                                   id="eq2_{{ partido.id }}"
                                                                   value="2"
                                                                   required>
                                                            <label class="btn btn-outline-danger w-100 py-3 rounded-3"
                                                                   for="eq2_{{ partido.id }}">
                                                                <i class="ti ti-shield d-block mb-1" style="font-size: 1.5rem;"></i>
                                                                <span class="fw-bold">Equipo 2</span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="d-grid gap-2 mt-4">
                                                    <button type="submit"
                                                            class="btn btn-lg rounded-pill fw-bold py-3"
                                                            style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                                                                   color: white">
                                                        <i class="ti ti-check me-2"></i>Confirmar Resultado
                                                    </button>
                                                    <button type="button" class="btn btn-link text-muted" data-bs-dismiss="modal">Cancelar</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Modal Editar Resultado (para partidos finalizados) -->
                            <div class="modal fade"
                                 id="editResultModal{{ partido.id }}"
                                 tabindex="-1"
                                 aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden"
                                         style="background: #0f172a">
                                        <div class="modal-header py-3 border-0"
                                             style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%)">
                                            <h5 class="modal-title fw-bold text-white d-flex align-items-center">
                                                <div class="bg-white bg-opacity-25 rounded-circle p-2 me-3 d-flex align-items-center justify-content-center"
                                                     style="width: 36px;
                                                            height: 36px">
                                                    <i class="ti ti-trophy-filled fs-5"></i>
                                                </div>
                                                Editar Resultado
                                            </h5>
                                            <button type="button"
                                                    class="btn-close btn-close-white"
                                                    data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body p-4" style="background: #0f172a;">
                                            <form method="POST" action="{% url 'core:admin_edit_result' partido.id %}">
                                                {% csrf_token %}
                                                <!-- Info del partido -->
                                                <div class="p-3 rounded-3 mb-4"
                                                     style="background: rgba(255,255,255,0.03)">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <div class="text-muted small">{{ partido.fecha|date:"d M, Y" }}</div>
                                                            <div class="text-white fw-bold">{{ partido.torneo.nombre|default:"Partido Casual" }}</div>
                                                        </div>
                                                        <span class="badge bg-success bg-opacity-10 text-success px-3 py-2">Finalizado</span>
                                                    </div>
                                                </div>
                                                <!-- Marcador actual -->
                                                <div class="mb-4">
                                                    <label class="form-label fw-bold text-muted small text-uppercase mb-2">Marcador</label>
                                                    <div class="input-group modern-input-group-modal">
                                                        <span class="input-group-text border-0 ps-3 bg-transparent"><i class="ti ti-numbers text-warning"></i></span>
                                                        <input type="text"
                                                               name="marcador"
                                                               class="form-control border-0 py-2 bg-transparent text-white"
                                                               value="{{ partido.marcador }}"
                                                               placeholder="Ej: 6-4, 6-3"
                                                               required>
                                                    </div>
                                                </div>
                                                <!-- Equipo Ganador -->
                                                <div class="mb-4">
                                                    <label class="form-label fw-bold text-muted small text-uppercase mb-2">Equipo Ganador</label>
                                                    <div class="row g-3">
                                                        <div class="col-6">
                                                            <input type="radio"
                                                                   class="btn-check"
                                                                   name="equipo_ganador"
                                                                   id="edit_eq1_{{ partido.id }}"
                                                                   value="1">
                                                            <label class="btn btn-outline-primary w-100 py-3 rounded-3"
                                                                   for="edit_eq1_{{ partido.id }}">
                                                                <i class="ti ti-shield d-block mb-1" style="font-size: 1.5rem;"></i>
                                                                <span class="fw-bold">Equipo 1</span>
                                                            </label>
                                                        </div>
                                                        <div class="col-6">
                                                            <input type="radio"
                                                                   class="btn-check"
                                                                   name="equipo_ganador"
                                                                   id="edit_eq2_{{ partido.id }}"
                                                                   value="2">
                                                            <label class="btn btn-outline-danger w-100 py-3 rounded-3"
                                                                   for="edit_eq2_{{ partido.id }}">
                                                                <i class="ti ti-shield d-block mb-1" style="font-size: 1.5rem;"></i>
                                                                <span class="fw-bold">Equipo 2</span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="d-grid gap-2 mt-4">
                                                    <button type="submit"
                                                            class="btn btn-lg rounded-pill fw-bold py-3"
                                                            style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
                                                                   color: white">
                                                        <i class="ti ti-device-floppy me-2"></i>Guardar Cambios
                                                    </button>
                                                    <button type="button" class="btn btn-link text-muted" data-bs-dismiss="modal">Cancelar</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-icon-container">
                    <i class="ti ti-calendar-off text-primary" style="font-size: 3.5rem;"></i>
                </div>
                <h3 class="fw-bold text-white">No hay partidos registrados</h3>
                <p class="text-muted mx-auto mb-0" style="max-width: 450px;">
                    Parece que no hay encuentros que coincidan con tus filtros. Puedes organizar un nuevo partido ahora mismo para mantener la actividad de la asociación.
                </p>
            </div>
        {% endif %}
    </div>
    <!-- Modal Crear Partido -->
    <div class="modal fade"
         id="createMatchModal"
         tabindex="-1"
         aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden"
                 style="background: #0f172a">
                <!-- Header Moderno con Gradiente -->
                <div class="modal-header py-3 border-0"
                     style="background: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%)">
                    <h5 class="modal-title fw-bold text-white d-flex align-items-center">
                        <div class="bg-white bg-opacity-25 rounded-circle p-2 me-3 d-flex align-items-center justify-content-center"
                             style="width: 36px;
                                    height: 36px">
                            <i class="ti ti-calendar-plus fs-5"></i>
                        </div>
                        Agendar Nuevo Partido
                    </h5>
                    <button type="button"
                            class="btn-close btn-close-white"
                            data-bs-dismiss="modal"
                            aria-label="Cerrar"></button>
                </div>
                <div class="modal-body p-4 p-md-5" style="background: #0f172a;">
                    <form action="{% url 'core:admin_create_match' %}"
                          method="POST"
                          id="createMatchForm">
                        {% csrf_token %}
                        <!-- Tipo de Partido -->
                        <div class="mb-4">
                            <div class="form-check form-switch d-flex align-items-center gap-3 p-3 rounded-3"
                                 style="background: rgba(255,255,255,0.03);
                                        border: 1px solid rgba(255,255,255,0.08)">
                                <input class="form-check-input"
                                       type="checkbox"
                                       role="switch"
                                       id="modal_es_casual"
                                       name="es_casual"
                                       style="width: 3rem;
                                              height: 1.5rem">
                                <label class="form-check-label text-white fw-bold" for="modal_es_casual">
                                    <i class="ti ti-ball-tennis me-2 text-primary"></i>Partido Casual / Amistoso
                                </label>
                            </div>
                            <small class="text-muted d-block mt-2 ps-2">Marque si el partido no pertenece a ningún torneo oficial.</small>
                        </div>
                        <!-- Torneo -->
                        <div class="mb-4" id="torneoFieldContainer">
                            <label class="form-label fw-bold text-muted small text-uppercase mb-2">Torneo</label>
                            <div class="input-group modern-input-group-modal">
                                <span class="input-group-text border-0 ps-3 bg-transparent"><i class="ti ti-trophy text-primary"></i></span>
                                <select name="torneo"
                                        id="modal_torneo"
                                        class="form-select border-0 py-2 bg-transparent text-white">
                                    <option value="">Seleccione un Torneo</option>
                                    {% for t in torneos_modal %}<option value="{{ t.id }}">{{ t.nombre }}</option>{% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="row g-4">
                            <!-- Cancha -->
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-muted small text-uppercase mb-2">Cancha</label>
                                <div class="input-group modern-input-group-modal">
                                    <span class="input-group-text border-0 ps-3 bg-transparent"><i class="ti ti-map-pin text-primary"></i></span>
                                    <select name="cancha"
                                            class="form-select border-0 py-2 bg-transparent text-white"
                                            required>
                                        <option value="">Seleccione una cancha</option>
                                        {% for c in canchas %}<option value="{{ c.id }}">{{ c.nombre }}</option>{% endfor %}
                                    </select>
                                </div>
                            </div>
                            <!-- Fecha -->
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-muted small text-uppercase mb-2">Fecha del Partido</label>
                                <div class="input-group modern-input-group-modal">
                                    <span class="input-group-text border-0 ps-3 bg-transparent"><i class="ti ti-calendar text-primary"></i></span>
                                    <input type="date"
                                           name="fecha"
                                           class="form-control border-0 py-2 bg-transparent text-white"
                                           required>
                                </div>
                            </div>
                            <!-- Hora -->
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-muted small text-uppercase mb-2">Horario</label>
                                <div class="input-group modern-input-group-modal">
                                    <span class="input-group-text border-0 ps-3 bg-transparent"><i class="ti ti-clock text-primary"></i></span>
                                    <select name="hora"
                                            class="form-select border-0 py-2 bg-transparent text-white"
                                            required>
                                        {% for valor, etiqueta in horarios %}<option value="{{ valor }}">{{ etiqueta }}</option>{% endfor %}
                                    </select>
                                </div>
                            </div>
                            <!-- Árbitro -->
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-muted small text-uppercase mb-2">Árbitro (Opcional)</label>
                                <div class="input-group modern-input-group-modal">
                                    <span class="input-group-text border-0 ps-3 bg-transparent"><i class="ti ti-user-check text-primary"></i></span>
                                    <select name="arbitro"
                                            class="form-select border-0 py-2 bg-transparent text-white">
                                        <option value="">Sin árbitro asignado</option>
                                        {% for a in arbitros %}<option value="{{ a.id }}">{{ a.first_name }} {{ a.last_name }}</option>{% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                        <!-- Separador Visual -->
                        <div class="my-4 py-3">
                            <div class="d-flex align-items-center gap-3">
                                <div class="flex-grow-1"
                                     style="height: 1px;
                                            background: rgba(255,255,255,0.1)"></div>
                                <span class="text-muted small text-uppercase fw-bold"><i class="ti ti-users me-2"></i>Equipos</span>
                                <div class="flex-grow-1"
                                     style="height: 1px;
                                            background: rgba(255,255,255,0.1)"></div>
                            </div>
                        </div>
                        <div class="row g-4">
                            <!-- Equipo 1 -->
                            <div class="col-md-6">
                                <div class="p-3 rounded-3"
                                     style="background: rgba(14, 165, 233, 0.08);
                                            border: 1px solid rgba(14, 165, 233, 0.2)">
                                    <h6 class="fw-bold text-primary mb-3">
                                        <i class="ti ti-shield me-2"></i>Equipo 1
                                    </h6>
                                    <div class="mb-3">
                                        <label class="form-label text-muted small">Jugador 1 *</label>
                                        <select name="equipo1_jugador1"
                                                class="form-select form-select-sm bg-dark border-0 text-white"
                                                required>
                                            <option value="">Seleccione jugador</option>
                                            {% for j in jugadores %}
                                                <option value="{{ j.id }}">{{ j.first_name }} {{ j.last_name }} ({{ j.cedula }})</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div>
                                        <label class="form-label text-muted small">Jugador 2 (Dobles)</label>
                                        <select name="equipo1_jugador2"
                                                class="form-select form-select-sm bg-dark border-0 text-white">
                                            <option value="">Sin segundo jugador</option>
                                            {% for j in jugadores %}
                                                <option value="{{ j.id }}">{{ j.first_name }} {{ j.last_name }} ({{ j.cedula }})</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <!-- Equipo 2 -->
                            <div class="col-md-6">
                                <div class="p-3 rounded-3"
                                     style="background: rgba(239, 68, 68, 0.08);
                                            border: 1px solid rgba(239, 68, 68, 0.2)">
                                    <h6 class="fw-bold text-danger mb-3">
                                        <i class="ti ti-shield me-2"></i>Equipo 2
                                    </h6>
                                    <div class="mb-3">
                                        <label class="form-label text-muted small">Jugador 1 *</label>
                                        <select name="equipo2_jugador1"
                                                class="form-select form-select-sm bg-dark border-0 text-white"
                                                required>
                                            <option value="">Seleccione jugador</option>
                                            {% for j in jugadores %}
                                                <option value="{{ j.id }}">{{ j.first_name }} {{ j.last_name }} ({{ j.cedula }})</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div>
                                        <label class="form-label text-muted small">Jugador 2 (Dobles)</label>
                                        <select name="equipo2_jugador2"
                                                class="form-select form-select-sm bg-dark border-0 text-white">
                                            <option value="">Sin segundo jugador</option>
                                            {% for j in jugadores %}
                                                <option value="{{ j.id }}">{{ j.first_name }} {{ j.last_name }} ({{ j.cedula }})</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Botones de Acción -->
                        <div class="d-grid gap-3 mt-5">
                            <button type="submit"
                                    class="btn btn-lg rounded-pill fw-bold py-3 shadow-sm"
                                    style="background: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%);
                                           color: white">
                                <i class="ti ti-calendar-check me-2"></i>Agendar Partido
                            </button>
                            <button type="button"
                                    class="btn btn-link text-muted fw-bold text-decoration-none shadow-none"
                                    data-bs-dismiss="modal">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <style>
/* Estilos del Modal */
.modern-input-group-modal {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 12px;
    transition: all 0.2s ease;
}
.modern-input-group-modal:focus-within {
    background: rgba(255, 255, 255, 0.06);
    border-color: #0ea5e9;
    box-shadow: 0 0 0 0.25rem rgba(14, 165, 233, 0.15);
}
.modern-input-group-modal .form-control,
.modern-input-group-modal .form-select {
    border: none !important;
    background: transparent !important;
    box-shadow: none !important;
    color: white !important;
}
.modern-input-group-modal .form-control::placeholder {
    color: rgba(255, 255, 255, 0.4);
}
.modern-input-group-modal .form-select option {
    background: #1e293b;
    color: white;
}
#createMatchModal .form-select-sm {
    padding: 0.5rem 0.75rem;
    border-radius: 8px;
}
#createMatchModal .form-select-sm option {
    background: #1e293b;
    color: white;
}
    </style>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    // Manejo del modal de crear partido
    const casualCheckbox = document.getElementById('modal_es_casual');
    const torneoContainer = document.getElementById('torneoFieldContainer');
    const torneoSelect = document.getElementById('modal_torneo');
    
    if (casualCheckbox && torneoContainer) {
        casualCheckbox.addEventListener('change', function() {
            if (this.checked) {
                torneoContainer.style.opacity = '0.4';
                torneoContainer.style.pointerEvents = 'none';
                torneoSelect.required = false;
                torneoSelect.value = '';
            } else {
                torneoContainer.style.opacity = '1';
                torneoContainer.style.pointerEvents = 'auto';
                torneoSelect.required = true;
            }
        });
    }
    
    // Set minimum date to today for create modal
    const fechaInput = document.querySelector('#createMatchModal input[name="fecha"]');
    if (fechaInput) {
        const today = new Date().toISOString().split('T')[0];
        fechaInput.setAttribute('min', today);
    }
    
    // Manejo de los modales de edición (múltiples)
    document.querySelectorAll('[id^="edit_es_casual_"]').forEach(function(checkbox) {
        const partidoId = checkbox.id.replace('edit_es_casual_', '');
        const container = document.getElementById('editTorneoContainer' + partidoId);
        const select = document.getElementById('edit_torneo_' + partidoId);
        
        if (container && select) {
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    container.style.opacity = '0.4';
                    container.style.pointerEvents = 'none';
                    select.required = false;
                    select.value = '';
                } else {
                    container.style.opacity = '1';
                    container.style.pointerEvents = 'auto';
                    select.required = true;
                }
            });
        }
    });
    
    // Abrir modal automáticamente si viene desde el panel de admin
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('open_modal') === 'crear') {
        const createModal = new bootstrap.Modal(document.getElementById('createMatchModal'));
        createModal.show();
        // Limpiar el parámetro de la URL sin recargar
        window.history.replaceState({}, document.title, window.location.pathname);
    }
});
    </script>
{% endblock %}
