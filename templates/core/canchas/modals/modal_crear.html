{% load static %}

<!-- Modal Crear Cancha -->
<div class="modal fade" id="createCourtModal" tabindex="-1" aria-labelledby="createCourtModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
            <div class="modal-header bg-primary py-3">
                <h5 class="modal-title fw-bold text-white" id="createCourtModalLabel">
                    <i class="ti ti-ball-tennis me-2"></i>Registrar Nueva Cancha
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body p-4 p-md-5">
                <form action="{% url 'core:admin_create_court' %}" method="POST" enctype="multipart/form-data"
                    class="modern-form">
                    {% csrf_token %}

                    <div class="row g-4">
                        <!-- Nombre -->
                        <div class="col-md-7">
                            <label class="form-label fw-bold text-muted small text-uppercase mb-2">Nombre de la
                                Cancha</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0"><i
                                        class="ti ti-id-badge-2"></i></span>
                                {{ form.nombre }}
                            </div>
                        </div>

                        <!-- Estado -->
                        <div class="col-md-5">
                            <label class="form-label fw-bold text-muted small text-uppercase mb-2">Estado
                                Inicial</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0"><i
                                        class="ti ti-activity"></i></span>
                                {{ form.estado }}
                            </div>
                        </div>

                        <!-- Ubicación -->
                        <div class="col-12">
                            <label class="form-label fw-bold text-muted small text-uppercase mb-2">Ubicación
                                Física</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0"><i
                                        class="ti ti-map-pin"></i></span>
                                {{ form.ubicacion }}
                            </div>
                        </div>

                        <!-- Grid de Detalles -->
                        <div class="col-md-4">
                            <label class="form-label fw-bold text-muted small text-uppercase mb-2">Precio / Hora</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0"><i
                                        class="ti ti-currency-dollar"></i></span>
                                {{ form.precio_hora }}
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label fw-bold text-muted small text-uppercase mb-2">Apertura</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0"><i class="ti ti-clock"></i></span>
                                {{ form.horario_apertura }}
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label fw-bold text-muted small text-uppercase mb-2">Cierre</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0"><i
                                        class="ti ti-clock-pause"></i></span>
                                {{ form.horario_cierre }}
                            </div>
                        </div>

                        <!-- Descripción -->
                        <div class="col-12">
                            <label class="form-label fw-bold text-muted small text-uppercase mb-2">Descripción</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0 align-items-start pt-2"><i
                                        class="ti ti-align-left"></i></span>
                                {{ form.descripcion }}
                            </div>
                        </div>

                        <!-- Imagen Drag & Drop -->
                        <div class="col-12">
                            <label class="form-label fw-bold text-muted small text-uppercase mb-2">Imagen de la
                                Cancha</label>
                            <div class="image-upload-wrapper">
                                <div id="court-drop-zone-modal" class="image-drop-zone"
                                    onclick="this.querySelector('input[type=file]').click()">

                                    <div class="d-none court-hidden-input">
                                        {{ form.imagen }}
                                    </div>

                                    <div class="drop-zone-content text-center p-4">
                                        <div class="upload-icon mb-3"><i
                                                class="ti ti-camera-plus fs-1 text-primary"></i></div>
                                        <div class="upload-text">
                                            <p class="fw-bold mb-1">Subir Foto</p>
                                            <p class="text-muted small mb-0">JPG o PNG. Máx 5MB.</p>
                                        </div>
                                    </div>

                                    <div id="court-image-overlay-modal" class="image-preview-overlay d-none">
                                        <img id="court-preview-img-modal" src="" alt="Vista previa">
                                        <div class="preview-actions">
                                            <span class="btn btn-primary rounded-pill px-4 shadow-lg fw-bold">
                                                <i class="ti ti-refresh me-2"></i>Cambiar Foto
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer border-0 px-0 pb-0 mt-4">
                        <button type="button" class="btn btn-outline-secondary btn-lg rounded-pill px-4"
                            data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary btn-lg rounded-pill px-5 fw-bold shadow-sm">
                            Guardar Cancha
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    .modern-form .input-group-text {
        border-radius: 12px 0 0 12px;
        color: var(--color-primary);
        background: rgba(var(--bs-primary-rgb), 0.03);
    }

    .modern-form .form-control,
    .modern-form .form-select {
        border-radius: 0 12px 12px 0;
        padding: 0.8rem 1rem;
        background-color: var(--color-bg-light) !important;
        border: 1px solid var(--color-border);
    }

    .modern-form textarea.form-control {
        border-radius: 0 12px 12px 12px;
    }

    .image-drop-zone {
        border: 2px dashed var(--color-border);
        border-radius: 20px;
        background: var(--color-bg-light);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        position: relative;
        overflow: hidden;
        min-height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .image-drop-zone.dragover {
        border-color: var(--color-primary);
        background: rgba(var(--bs-primary-rgb), 0.05);
    }

    .image-preview-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        z-index: 5;
    }

    .image-preview-overlay img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .preview-actions {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 6;
    }

    .image-drop-zone:hover .preview-actions {
        opacity: 1;
    }
</style>

<script>
    (function () {
        const dropZone = document.getElementById('court-drop-zone-modal');
        if (!dropZone) return;

        const fileInput = dropZone.querySelector('input[type="file"]');
        const preview = document.getElementById('court-preview-img-modal');
        const overlay = document.getElementById('court-image-overlay-modal');

        fileInput.addEventListener('change', function () {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    overlay.classList.remove('d-none');
                    dropZone.classList.add('has-image');
                }
                reader.readAsDataURL(this.files[0]);
            }
        });

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, e => {
                e.preventDefault();
                e.stopPropagation();
            }, false);
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false);
        });

        dropZone.addEventListener('drop', e => {
            if (e.dataTransfer.files.length > 0) {
                fileInput.files = e.dataTransfer.files;
                fileInput.dispatchEvent(new Event('change'));
            }
        }, false);
    })();
</script>