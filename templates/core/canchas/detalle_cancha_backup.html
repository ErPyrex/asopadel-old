{% extends 'base.html' %}
{% block title %}{{ cancha.nombre }} - Detalles{% endblock %}
{% block content %}
<div class="container mt-5">
    <div class="row">
        <!-- Court Image -->
        <div class="col-md-6 mb-4">
            {% if cancha.imagen %}
            <img src="{{ cancha.imagen.url }}" class="img-fluid rounded shadow-lg" alt="{{ cancha.nombre }}"
                style="width: 100%; height: 400px; object-fit: cover;">
            {% else %}
            <div class="bg-secondary text-white d-flex align-items-center justify-content-center rounded shadow-lg"
                style="height: 400px;">
                <h4>Sin Imagen Disponible</h4>
            </div>
            {% endif %}
        </div>

        <!-- Court Details -->
        <div class="col-md-6">
            <h1 class="display-4 fw-bold mb-3">{{ cancha.nombre }}</h1>

            <div class="mb-4">
                <span
                    class="badge {% if cancha.estado == 'disponible' %}bg-success{% elif cancha.estado == 'reservada' %}bg-info text-dark{% else %}bg-danger{% endif %} p-2 fs-6">
                    {% if cancha.estado == 'reservada' %}
                    Parcialmente Reservada
                    {% else %}
                    {{ cancha.get_estado_display }}
                    {% endif %}
                </span>
                <span class="text-muted ms-2"><i class="bi bi-geo-alt-fill"></i> {{ cancha.ubicacion }}</span>
            </div>

            <div class="card bg-light border-0 mb-4">
                <div class="card-body">
                    <h5 class="card-title text-primary"><i class="bi bi-clock"></i> Horario y Tarifas</h5>
                    <ul class="list-unstyled mt-3">
                        <li class="mb-2"><strong><i class="bi bi-cash-coin"></i> Precio por hora:</strong> ${{
                            cancha.precio_hora }}</li>
                        <li class="mb-2"><strong><i class="bi bi-hourglass-split"></i> Horario:</strong> {{
                            cancha.horario_apertura|time:"H:i" }} - {{ cancha.horario_cierre|time:"H:i" }}</li>

                    </ul>
                </div>
            </div>

            <div class="mb-5">
                <h5>Descripción</h5>
                <p class="lead fs-6">{{ cancha.descripcion|default:"No hay descripción disponible para esta
                    cancha."|linebreaks }}</p>
            </div>

            <div class="d-grid gap-2">
                {% if user.is_authenticated %}
                {% if cancha.estado == 'disponible' or cancha.estado == 'reservada' %}
                <!-- Permitir reservar incluso si está reservada parcialmente, la validación interna chequeará horarios -->
                <form method="get" action="{% url 'core:player_reserve_court' %}">
                    <input type="hidden" name="cancha_id" value="{{ cancha.id }}">
                    <button type="submit" class="btn btn-primary btn-lg w-100">
                        <i class="bi bi-calendar-check"></i> Reservar Ahora
                    </button>
                </form>
                {% else %}
                <div class="alert alert-danger text-center mb-0">
                    <strong><i class="bi bi-exclamation-triangle-fill"></i> No Disponible</strong><br>
                    La cancha se encuentra en mantenimiento.
                </div>
                {% endif %}
                {% else %}
                <a href="{% url 'users:login' %}?next={{ request.path }}" class="btn btn-outline-primary btn-lg">
                    <i class="bi bi-box-arrow-in-right"></i> Inicia sesión para reservar
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}