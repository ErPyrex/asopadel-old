{% extends 'base.html' %}
{% load static %}
{% block title %}Perfil de {{ jugador.get_full_name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Header Perfil -->
    <div class="card shadow-sm border-0 mb-4 overflow-hidden">
        <div class="card-body p-0">
            <div class="row g-0">
                <div class="col-md-8 p-4 d-flex align-items-center">
                    {% if jugador.foto %}
                    <img src="{{ jugador.foto.url }}" alt="{{ jugador.get_full_name }}"
                        class="rounded-circle border border-4 border-white shadow me-4"
                        style="width: 120px; height: 120px; object-fit: cover;">
                    {% else %}
                    <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center shadow me-4"
                        style="width: 120px; height: 120px; font-size: 3rem;">
                        {{ jugador.first_name|first }}{{ jugador.last_name|first }}
                    </div>
                    {% endif %}
                    <div>
                        <h2 class="mb-1 fw-bold">{{ jugador.get_full_name }}</h2>
                        <span class="badge bg-primary fs-6">{{ jugador.get_categoria_display }}</span>
                        <div class="mt-2 text-muted">
                            <i class="bi bi-geo-alt"></i> {{ jugador.telefono|default:"Sin tel茅fono p煤blico" }}
                        </div>
                    </div>
                </div>
                <div
                    class="col-md-4 bg-light p-4 d-flex flex-column justify-content-center align-items-center text-center border-start text-dark">
                    <small class="text-uppercase fw-bold ls-1">Ranking ELO</small>
                    <h1 class="display-3 fw-bold text-primary mb-0">{{ jugador.ranking }}</h1>
                    <small class="fw-bold">Puntos</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Grid de Estad铆sticas -->
    <div class="row mb-4 g-3">
        <!-- Partidos -->
        <div class="col-6 col-md-3 col-lg">
            <div class="card h-100 shadow-sm border-0 text-center py-3">
                <div class="card-body">
                    <h3 class="display-6 fw-bold mb-0">{{ total_jugados }}</h3>
                    <small class="text-muted">Partidos Jugados</small>
                </div>
            </div>
        </div>
        <!-- Victorias -->
        <div class="col-6 col-md-3 col-lg">
            <div class="card h-100 shadow-sm border-0 text-center py-3">
                <div class="card-body">
                    <h3 class="display-6 fw-bold text-success mb-0">{{ total_victorias }}</h3>
                    <small class="text-muted">Victorias</small>
                </div>
            </div>
        </div>
        <!-- Derrotas -->
        <div class="col-6 col-md-3 col-lg">
            <div class="card h-100 shadow-sm border-0 text-center py-3">
                <div class="card-body">
                    <h3 class="display-6 fw-bold text-danger mb-0">{{ total_derrotas }}</h3>
                    <small class="text-muted">Derrotas</small>
                </div>
            </div>
        </div>
        <!-- Efectividad -->
        <div class="col-6 col-md-3 col-lg">
            <div class="card h-100 shadow-sm border-0 text-center py-3">
                <div class="card-body">
                    <h3 class="display-6 fw-bold text-info mb-0">{{ efectividad }}%</h3>
                    <small class="text-muted">Efectividad</small>
                </div>
            </div>
        </div>
        <!-- Ratio -->
        <div class="col-6 col-md-3 col-lg">
            <div class="card h-100 shadow-sm border-0 text-center py-3">
                <div class="card-body">
                    <h3 class="display-6 fw-bold text-warning mb-0">{{ ratio }}</h3>
                    <small class="text-muted">Ratio V/D</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Historial de Partidos -->
    <div class="card shadow-sm border-0">
        <div class="card-header bg-white py-3">
            <h5 class="mb-0 fw-bold"> ltimos Partidos</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Fecha</th>
                        <th>Torneo</th>
                        <th>Resultado</th>
                        <th>Marcador</th>
                    </tr>
                </thead>
                <tbody>
                    {% for partido in ultimos_partidos %}
                    <tr>
                        <td>{{ partido.fecha|date:"d M Y" }}</td>
                        <td>{{ partido.torneo.nombre }}</td>
                        <td>
                            {# L贸gica simple para ver si gan贸 o perdi贸 (ya que no guardamos el resultado por jugador en
                            el modelo partido directo, sino en signals) #}
                            {# Aqu铆 asumimos que signals actualiz贸 ranking, pero para visualizaci贸n visual r谩pida
                            tocar铆a recalcular o asumir #}
                            <span class="badge bg-secondary">Finalizado</span>
                        </td>
                        <td class="font-monospace">{{ partido.marcador }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center py-5 text-muted">
                            No hay partidos registrados.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}